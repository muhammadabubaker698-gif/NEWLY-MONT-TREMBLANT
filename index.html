<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Mont Tremblant Limo Services | Luxury Chauffeur</title>
<meta name="description" content="Luxury chauffeur service in Mont-Tremblant. Escalade, Suburban, Denali, QX60, Tesla & Sprinter. Minimum 1 hour for hourly bookings. Vehicle minimum fares apply. Call or WhatsApp +1 (438) 320-3733." />
<link rel="canonical" href="https://monttremblantlimoservices.com/" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"LocalBusiness",
  "name":"Mont Tremblant Limo Services",
  "url":"https://monttremblantlimoservices.com/",
  "telephone":"+1-438-320-3733",
  "description":"Luxury chauffeur service in Mont-Tremblant. Premium vehicles for airport transfers, hourly bookings, ski trips, corporate travel, and special events. Minimum 1 hour for hourly bookings. Vehicle minimum fares apply.",
  "areaServed":[
    {"@type":"City","name":"Mont-Tremblant"},
    {"@type":"City","name":"Montr√©al"},
    {"@type":"City","name":"Ottawa"},
    {"@type":"City","name":"Qu√©bec City"},
    {"@type":"City","name":"New York"},
    {"@type":"City","name":"Boston"},
    {"@type":"AdministrativeArea","name":"New Jersey"}
  ],
  "address":{
    "@type":"PostalAddress",
    "addressLocality":"Mont-Tremblant",
    "addressRegion":"QC",
    "addressCountry":"CA"
  },
  "image":[ "https://monttremblantlimoservices.com/Tremblant.jpg" ],
  "sameAs":[ "https://wa.me/14383203733" ]
}
</script>

<style>
  :root{
    --bg:#ffffff;
    --ink:#0b1220;
    --muted: rgba(11,18,32,.68);
    --line: rgba(11,18,32,.10);
    --shadow: 0 18px 55px rgba(0,0,0,.14);
    --shadow2: 0 10px 28px rgba(0,0,0,.10);
    --radius: 16px;
    --max: 1160px;
    --gradA:#ff2e63;
    --gradB:#ff7a00;
    --good:#0f9d58;
    --bad:#b00020;

    --flowbar-h: 180px;
    --vh: 100vh;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html{scroll-behavior:smooth}
  body{
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: var(--bg);
    color: var(--ink);
    line-height: 1.6;
    font-size: 16px;
    overflow-x:hidden;
  }

  html, body{ width:100%; max-width:100%; overflow-x:hidden; }
  img, video, canvas, svg{ max-width:100%; height:auto; }

  a{color:inherit;text-decoration:none}
  .container{max-width:var(--max);margin:0 auto;padding: 0 18px}
  section{ scroll-margin-top: 96px; }
  main{padding-bottom: 64px}

  header{
    position: sticky;
    top:0;
    z-index:50;
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--line);
  }
  .nav{
    height: 76px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
    font-weight: 950;
    letter-spacing: .4px;
  }
  .logo{
    width: 38px; height: 38px;
    border-radius: 12px;
    background: #0b1220;
    color:#fff;
    display:grid;
    place-items:center;
    font-weight: 950;
  }
  .links{
    display:flex;
    align-items:center;
    gap: 12px;
    flex-wrap:wrap;
    justify-content:center;
  }
  .links a{
    color: rgba(11,18,32,.78);
    font-weight: 800;
    font-size: 14px;
    padding: 10px 10px;
    border-radius: 12px;
    transition: .15s ease;
  }
  .links a:hover{ background: rgba(11,18,32,.06); color: rgba(11,18,32,.92); }

  .header-actions{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .pill{
    display:none;
    font-size: 13px;
    color: rgba(11,18,32,.75);
    font-weight: 800;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid rgba(11,18,32,.12);
    background: rgba(255,255,255,.65);
    white-space:nowrap;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding: 11px 16px;
    border-radius: 999px;
    font-weight: 900;
    border: 1px solid rgba(11,18,32,.14);
    background: #fff;
    box-shadow: var(--shadow2);
    color: rgba(11,18,32,.92);
    transition: transform .15s ease, box-shadow .15s ease;
    cursor:pointer;
    white-space:nowrap;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow: 0 16px 34px rgba(0,0,0,.12); }
  .btn-primary{
    border: none;
    color:#fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    box-shadow: 0 18px 44px rgba(255,90,20,.22);
  }

  .hero-wrap{
    position:relative;
    border-bottom: 1px solid var(--line);
    background:
      linear-gradient(90deg, rgba(255,255,255,.55) 0%, rgba(255,255,255,.18) 45%, rgba(255,255,255,0) 72%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.12)),
      url("/Tremblant.jpg") center/cover no-repeat;
  }
  .hero-inner{
    display:grid;
    grid-template-columns: 1.25fr .75fr;
    align-items: start;
    gap: 22px;
    padding: 26px 0 34px;
    min-height: 520px;
  }
  .hero-left{ padding: 0 18px; }
  .hero-title{
    font-size: clamp(34px, 4vw, 58px);
    line-height: 1.05;
    letter-spacing: -0.6px;
    font-weight: 950;
    color:#0b1220;
    max-width: 18ch;
    margin-top: 24px;
  }
  .hero-sub{
    margin-top: 12px;
    color: rgba(11,18,32,.74);
    font-size: 17px;
    max-width: 68ch;
    font-weight: 700;
  }
  .hero-badges{
    margin-top: 18px;
    display:flex;
    flex-wrap:wrap;
    gap: 10px;
  }
  .badge{
    padding: 9px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.75);
    border: 1px solid rgba(11,18,32,.10);
    color: rgba(11,18,32,.75);
    font-weight: 900;
    font-size: 13px;
    box-shadow: 0 10px 20px rgba(0,0,0,.06);
  }

  .booking-card{
    margin-right: 18px;
    justify-self:end;
    width: min(430px, 100%);
    border-radius: 14px;
    background: #fff;
    box-shadow: 0 28px 70px rgba(0,0,0,.24);
    border: 1px solid rgba(11,18,32,.10);
    overflow:hidden;
  }
  .tabs{
    display:flex;
    background: #fff;
    border-bottom: 1px solid rgba(11,18,32,.08);
  }
  .tabhint{margin-top:10px; font-size:13px; color: rgba(11,18,32,.72); line-height:1.35;}
  .tabhint b{color: rgba(11,18,32,.92);} 
  .tab{
    flex:1;
    padding: 14px 14px;
    font-weight: 950;
    font-size: 14px;
    color: rgba(11,18,32,.78);
    background: #fff;
    border:none;
    cursor:pointer;
  }
  .tab.active{
    background: #f4f5f7;
    color: rgba(11,18,32,.94);
  }

  .book-body{ padding: 14px; background: #fff; }

  .stepbar{
    display:flex;
    gap: 8px;
    align-items:center;
    justify-content:space-between;
    margin: 6px 0 12px;
  }
  .stepdot{
    flex: 1;
    height: 6px;
    border-radius: 999px;
    background: rgba(11,18,32,.10);
    overflow:hidden;
    position:relative;
  }
  .stepdot > i{
    position:absolute; inset:0;
    width: 33%;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    border-radius: 999px;
  }
  .steptext{
    font-size: 12.5px;
    color: rgba(11,18,32,.65);
    font-weight: 900;
    white-space:nowrap;
    margin-left: 10px;
  }

  .field{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 12px 12px;
    border-radius: 10px;
    border: 1px solid rgba(11,18,32,.10);
    background: #f4f5f7;
    margin-bottom: 10px;
    min-width: 0;
  }
  .ico{ width: 18px; height: 18px; color: rgba(11,18,32,.55); flex:0 0 auto; }
  .field input, .field select{
    width:100%;
    border:none;
    outline:none;
    background: transparent;
    font-size: 16px;
    font-weight: 800;
    color: rgba(11,18,32,.90);
    min-width: 0;
  }
  .field input::placeholder{ color: rgba(11,18,32,.50); font-weight:800; }

  /* ‚úÖ Autocomplete UI */
  .autocomplete-wrap{ position:relative; }
  .autocomplete-list{
    position:absolute;
    top: calc(100% - 8px);
    left:0;
    right:0;
    z-index:30;
    background:#fff;
    border:1px solid rgba(11,18,32,.12);
    border-radius: 12px;
    box-shadow: 0 16px 28px rgba(0,0,0,.12);
    display:none;
    max-height: 220px;
    overflow:auto;
  }
  .autocomplete-list button{
    width:100%;
    border:none;
    border-top:1px solid rgba(11,18,32,.08);
    background:#fff;
    text-align:left;
    padding: 10px 12px;
    font-size: 14px;
    font-weight:700;
    color: rgba(11,18,32,.84);
    cursor:pointer;
  }
  .autocomplete-list button:first-child{ border-top:none; }
  .autocomplete-list button:hover{ background: rgba(11,18,32,.04); }
  .autocomplete-list .muted{ color: rgba(11,18,32,.55); font-size:12px; display:block; margin-top:2px; }

  .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .note{ margin: 8px 4px 10px; color: rgba(11,18,32,.62); font-size: 12.8px; font-weight: 800; }

  .search-btn{
    width:100%;
    border:none;
    border-radius: 10px;
    padding: 13px 14px;
    font-weight: 950;
    font-size: 15px;
    color: #fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    cursor:pointer;
    box-shadow: 0 18px 44px rgba(255,90,20,.22);
  }
  .search-btn[disabled]{ opacity:.65; cursor:not-allowed; box-shadow:none; }

  .alert{
    display:none;
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fbfbfc;
    font-weight: 850;
    font-size: 13px;
  }
  .alert.bad{ border-color: rgba(176,0,32,.25); background: rgba(176,0,32,.06); color: var(--bad); }

  .overlay{
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: rgba(255,255,255,.96);
    display: none;
    overflow: hidden;
    overscroll-behavior: contain;
  }
  .overlay.show{ display: block; }

  .overlay-top{
    height: 76px;
    border-bottom: 1px solid rgba(11,18,32,.10);
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
    display:flex;
    align-items:center;
  }
  .overlay-top .container{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    width: 100%;
  }
  .overlay-title{
    font-weight: 950;
    letter-spacing: .2px;
  }
  .overlay-close{
    border: 1px solid rgba(11,18,32,.14);
    background: #fff;
    border-radius: 12px;
    padding: 10px 12px;
    font-weight: 900;
    cursor: pointer;
  }

  .overlay-body{
    height: calc(var(--vh) - 76px);
    height: calc(-webkit-fill-available - 76px);
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    padding: 26px 0 calc(var(--flowbar-h) + env(safe-area-inset-bottom) + 16px);
    touch-action: pan-y;
  }

  .flow-wrap{
    max-width: 760px;
    width: 100%;
    margin: 0 auto;
    padding: 0 18px;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .flow-steps{
    display:flex;
    gap: 18px;
    align-items:center;
    justify-content:center;
    color: rgba(11,18,32,.55);
    font-weight: 900;
    font-size: 13px;
    margin-bottom: 14px;
    flex-wrap: wrap;
    text-align:center;
  }
  .flow-steps .on{ color: rgba(11,18,32,.92); }

  .summary-pill{
    border: 1px solid rgba(11,18,32,.12);
    border-radius: 16px;
    background: #fbfbfc;
    padding: 14px 16px;
    font-weight: 800;
    color: rgba(11,18,32,.82);
  }
  .summary-pill small{
    display:block;
    color: rgba(11,18,32,.62);
    font-weight: 800;
    margin-top: 4px;
  }

  .flow-h1{
    margin-top: 18px;
    font-size: 28px;
    line-height: 1.15;
    letter-spacing: -.2px;
    font-weight: 950;
  }
  .flow-sub{
    margin-top: 8px;
    color: rgba(11,18,32,.66);
    font-weight: 750;
  }

  .vlist{
    margin-top: 16px;
    border: 1px solid rgba(11,18,32,.12);
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
  }

  .vrow{
    position: relative;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 14px;
    padding: 14px 14px;
    border-top: 1px solid rgba(11,18,32,.10);
    cursor: pointer;
    transition: transform .12s ease, padding .12s ease, background .12s ease;
    min-width: 0;
  }
  .vrow:first-child{ border-top: none; }
  .vrow:hover{ background: rgba(11,18,32,.03); }

  .vcheck{
    position:absolute;
    right: 16px;
    top: 14px;
    width: 22px;
    height: 22px;
    border-radius: 999px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 13px;
    font-weight: 950;
    color: #fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    box-shadow: 0 10px 18px rgba(255,90,20,.20);
    opacity: 0;
    transform: scale(.92);
    transition: opacity .12s ease, transform .12s ease;
    pointer-events:none;
  }

  .vrow.selected{
    background: rgba(255,90,20,.06);
    padding-top: 18px;
    padding-bottom: 18px;
    transform: translateY(-1px);
    z-index: 2;
  }
  .vrow.selected .vcheck{ opacity: 1; transform: scale(1); }
  .vrow.selected::after{
    content:"";
    position:absolute;
    inset: 6px;
    border-radius: 14px;
    border: 2px solid rgba(255,90,20,.55);
    pointer-events:none;
  }
  .vrow.hide-top-border{ border-top-color: transparent; }

  .vleft, .vright{ min-width:0; }
  .vleft b{ display:block; font-weight: 950; word-break: break-word; }
  .vleft small{ display:block; margin-top: 2px; color: rgba(11,18,32,.62); font-weight: 800; }
  .vright{
    text-align:right;
    font-weight: 950;
    white-space: nowrap;
    padding-right: 26px;
  }

  .veh-img{
    width: 96px;
    height: 60px;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,.08);
    flex: 0 0 auto;
    background: #fff;
  }

  .flow-actions{
    margin-top: 18px;
    position: sticky;
    bottom: 0;
    z-index: 5;
    background: rgba(255,255,255,.96);
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(11,18,32,.10);
    padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
    display:flex;
    gap: 12px;
    justify-content: space-between;
    flex-wrap: wrap;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    will-change: transform;
  }

  .flow-actions .btn{
    border-radius: 14px;
    padding: 12px 14px;
    box-shadow:none;
  }
  .flow-actions .btn-primary{
    box-shadow: 0 16px 34px rgba(255,90,20,.18);
  }
  .btn:disabled{ opacity:.55; cursor:not-allowed; }

  html.overlay-open .whatsapp-float{ display:none !important; }

  label{
    display:block;
    margin: 12px 0 6px;
    font-size: 12.5px;
    font-weight: 900;
    color: rgba(11,18,32,.74);
    letter-spacing: .18px;
  }
  input, select, textarea{
    width:100%;
    padding: 12px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.14);
    background: #f4f5f7;
    color: rgba(11,18,32,.92);
    outline:none;
    font-weight: 800;
    font-size: 16px;
  }
  textarea{min-height: 92px; resize: vertical}

  .estimate-box{
    margin-top: 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fbfbfc;
    padding: 12px;
  }
  .estimate-top{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
  .estimate-top b{font-size:13.5px}
  .estimate-value{font-weight:950}
  .estimate-sub{margin-top:6px;color: rgba(11,18,32,.68);font-size:12.8px;font-weight:700}
  .tinyhint{margin-top:6px;font-size:12.5px;color:rgba(11,18,32,.62);font-weight:700}

  .section{ margin-top: 46px; }
  h2{ font-size: 30px; letter-spacing: -.2px; line-height:1.15; }
  .subtitle{
    margin-top: 10px;
    color: rgba(11,18,32,.66);
    font-weight: 700;
    max-width: 920px;
  }
  .grid3{
    margin-top: 16px;
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 14px;
  }
  .card{
    border-radius: var(--radius);
    border: 1px solid rgba(11,18,32,.10);
    background: #fff;
    box-shadow: 0 14px 36px rgba(0,0,0,.08);
    overflow:hidden;
  }
  .card-media img{width:100%;aspect-ratio: 16/10;object-fit:cover;display:block}
  .card-body{padding: 14px}
  .card-body h3{ font-size: 17px; letter-spacing: -.1px; }
  .meta{ margin-top: 6px; color: rgba(11,18,32,.66); font-weight:700; font-size: 13.5px; }
  .price{ margin-top: 10px; font-weight: 950; }
  .min{ margin-top: 3px; color: rgba(11,18,32,.58); font-weight: 800; font-size: 12.5px; }
  .actions{ margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; }
  .actions .btn{ box-shadow:none; }
  .actions-reserve .btn{ font-size: 13.5px; padding: 10px 14px; }
  .btn-whatsapp{
    border: none;
    color: #fff;
    background: linear-gradient(90deg, #22c55e, #16a34a);
    box-shadow: 0 16px 34px rgba(34,197,94,.22);
  }

  .selected-vehicle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #f5f6f8;
    font-size: 13px;
    font-weight: 800;
    color: rgba(11,18,32,.8);
  }
  .selected-vehicle-info{
    display:flex;
    align-items:center;
    gap:10px;
    min-width: 0;
  }
  .selected-vehicle-info img{
    width: 44px;
    height: 32px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fff;
    flex: 0 0 auto;
  }
  .selected-vehicle button{
    border: 1px solid rgba(11,18,32,.16);
    background: #fff;
    border-radius: 999px;
    padding: 6px 12px;
    font-weight: 800;
    cursor:pointer;
  }

  footer{
    margin-top: 64px;
    padding: 26px 0;
    text-align:center;
    color: rgba(11,18,32,.62);
    border-top: 1px solid rgba(11,18,32,.10);
    font-weight: 700;
  }

  .whatsapp-float{
    position:fixed;
    right: 96px;
    bottom: 16px;
    background:#25D366;
    color:#0b0b0b;
    padding: 12px 16px;
    border-radius: 999px;
    font-weight: 950;
    box-shadow: 0 16px 38px rgba(0,0,0,.16);
    z-index:60;
    border: 1px solid rgba(0,0,0,.14);
  }

  @media (max-width: 680px){
    .overlay-top .container{ padding-left: 12px; padding-right: 12px; }
    .overlay-title{ font-size: 14px; }
    .overlay-close{ padding: 9px 10px; border-radius: 12px; }

    .vrow{
      display: grid;
      grid-template-columns: 76px 1fr auto;
      align-items: center;
      gap: 12px;
    }
    .veh-img{
      width: 76px;
      height: 52px;
      border-radius: 12px;
    }
    .vright{
      padding-right: 18px;
      text-align: right;
    }
    .vleft b{ font-size: 15px; line-height: 1.2; }
    .vleft small{ font-size: 12.5px; }

    .flow-actions{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      margin-top: 0;
      padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
      z-index: 999999;
    }

    .flow-actions .btn{
      flex: 1 1 auto;
      min-width: 140px;
    }
  }

  @media (max-width: 980px){
    .hero-inner{ grid-template-columns: 1fr; }
    .booking-card{ justify-self:stretch; margin: 14px 18px 0; width:auto; }
    .grid3{ grid-template-columns: 1fr; }
    .row2{ grid-template-columns: 1fr; }
  }
  @media (max-width: 860px){
    .links{ display:none; }
    .pill{ display:inline-flex; }
    .header-actions .btn{ display:none; }
  }

/* Google map preview */
.gmap{
  width:100%;
  height:220px;
  border-radius:16px;
  overflow:hidden;
  background:#eef2f7;
  margin:12px 0 10px;
}
@media (max-width: 520px){
  .gmap{ height:200px; }
}


/* Google Places dropdown */
.pac-container{z-index:999999 !important;}

/* Route summary */
.route-info{
  margin-top:10px;
  padding:10px 12px;
  border:1px solid rgba(0,0,0,.08);
  border-radius:14px;
  background: rgba(255,255,255,.88);
  backdrop-filter: blur(6px);
}
.route-info .ri-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  font-size:14px;
  line-height:1.25;
  padding:4px 0;
}
.route-info .ri-row span{ color:#6b7280; }
.route-info .ri-row strong{ font-weight:700; color:#111827; }
.route-info .ri-badges{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
.route-info .ri-badge{
  display:inline-flex; align-items:center; gap:6px;
  font-size:12px; font-weight:600;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.08);
  background:#fff;
}

/* Mobile keyboard UX: avoid iOS zoom + better keyboard */
#h_pickup, #h_dropoff{
  font-size:16px; /* prevents iOS zoom */
}

/* Language switch */
.lang-switch{
  display:flex;
  gap:6px;
  align-items:center;
  padding:6px;
  border-radius:999px;
  border:1px solid rgba(11,18,32,.14);
  background: rgba(255,255,255,.65);
}
.lang-btn{
  border:none;
  border-radius:999px;
  padding:8px 10px;
  font-weight:900;
  cursor:pointer;
  background: transparent;
  color: rgba(11,18,32,.80);
}
.lang-btn.active{
  background: rgba(11,18,32,.10);
  color: rgba(11,18,32,.92);
}

/* Contact section */
.contact-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  margin-top: 16px;
}
.contact-card{
  border: 1px solid rgba(11,18,32,.10);
  border-radius: 16px;
  background: #fff;
  box-shadow: 0 14px 36px rgba(0,0,0,.08);
  padding: 16px;
}
.contact-card h3{ font-size: 17px; letter-spacing: -.1px; }
.contact-card p{ margin-top: 10px; color: rgba(11,18,32,.74); font-weight: 750; }
.contact-card input, .contact-card textarea{
  margin-top: 10px;
}
.contact-map iframe{
  width:100%;
  height: 320px;
  border: 0;
  border-radius: 16px;
  margin-top: 14px;
}

/* Footer columns */
.footer-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 18px;
  text-align:left;
}
footer a:hover{ text-decoration: underline; }

/* Sticky contact bar */
.contact-bar{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 99998;
  background: rgba(11,18,32,.94);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255,255,255,.14);
  padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
  display:flex;
  gap: 10px;
  justify-content: center;
}
.contact-bar a{
  color:#fff;
  font-weight: 900;
  text-decoration:none;
  border: 1px solid rgba(255,255,255,.18);
  padding: 10px 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
}

/* Make room for contact bar on desktop */
body{ padding-bottom: 64px; }

@media (max-width: 700px){
  .contact-grid{ grid-template-columns: 1fr; }
  .footer-grid{ grid-template-columns: 1fr; text-align:center; }
  .contact-bar{ justify-content: space-around; }
}

</style>

<link rel="preconnect" href="https://maps.googleapis.com">
<link rel="preconnect" href="https://maps.gstatic.com" crossorigin>
</head>

<body>
<header>
  <div class="container">
    <div class="nav">
      <div class="brand">
        <div class="logo">MT</div>
        <div>Mont Tremblant Limo</div>
      </div>

      <div class="links">
        <a href="#fleet" data-i18n="nav_fleet">Our fleet</a>
        <a href="#routes" data-i18n="nav_routes">Destinations</a>
        <a href="#faq" data-i18n="nav_faq">FAQ</a>
        <a href="#contact" data-i18n="nav_contact">Contact</a>
      </div>

      <div class="header-actions">
        <div class="lang-switch" aria-label="Language switcher">
          <button type="button" class="lang-btn active" data-lang="en" aria-pressed="true">EN</button>
          <button type="button" class="lang-btn" data-lang="fr" aria-pressed="false">FR</button>
        </div>

        <span class="pill">üìû <a href="tel:+14383203733">+1 (438) 320-3733</a></span>
        <a class="btn" href="https://wa.me/14383203733" target="_blank" rel="noreferrer" data-i18n="nav_whatsapp">WhatsApp</a>
      </div>
    </div>
  </div>
</header>

<div class="hero-wrap">
  <div class="hero-inner container">
    <div class="hero-left">
      <div class="hero-title" data-i18n="hero_title">Luxury chauffeur service in Mont-Tremblant</div>
      <div class="hero-sub" data-i18n="hero_sub">Airport transfers, hourly bookings, ski trips, corporate travel and special events.</div>

      <div class="hero-badges">
        <span class="badge" data-i18n="badge_247">24/7 booking</span>
        <span class="badge" data-i18n="badge_pro">Professional chauffeurs</span>
        <span class="badge" data-i18n="badge_premium">Premium vehicles</span>
        <span class="badge" data-i18n="badge_cities">Mont-Tremblant ‚Ä¢ Montr√©al ‚Ä¢ Ottawa</span>
      </div>
    </div>

    <aside id="booking" class="booking-card" aria-label="Search booking">
      <div class="tabs">
        <button id="tabOneWay" class="tab active" type="button" aria-selected="true">One way</button>
        <button id="tabHourly" class="tab" type="button" aria-selected="false">By the hour (min 3h)</button>
      </div>
      <div class="tabhint">Need a chauffeur for events, shopping or a night out? Choose <b>By the hour</b> (minimum 3 hours).</div>

      <div class="book-body">
        <div class="stepbar" aria-hidden="true">
          <div class="stepdot"><i></i></div>
          <div class="steptext">Step 1 of 3</div>
        </div>

        <form id="heroSearchForm">
          <input type="hidden" id="heroMode" value="one_way" />

          <!-- ‚úÖ store coordinates when user picks a suggestion -->
          <input type="hidden" id="h_pickup_lat" value="" />
          <input type="hidden" id="h_pickup_lng" value="" />
          <input type="hidden" id="h_dropoff_lat" value="" />
          <input type="hidden" id="h_dropoff_lng" value="" />

          <!-- route + pricing -->
          <input type="hidden" id="h_distance_m" value="" />
          <input type="hidden" id="h_duration_s" value="" />
          <input type="hidden" id="h_price_estimate" value="" />
          <input type="hidden" id="h_pickup_airport" value="" />
          <input type="hidden" id="h_dropoff_airport" value="" />

          <div id="selectedVehicleBanner" class="selected-vehicle" style="display:none;">
            <div class="selected-vehicle-info">
              <img id="selectedVehicleImage" src="" alt="" />
              <span>Selected vehicle: <b id="selectedVehicleName"></b></span>
            </div>
            <button id="clearSelectedVehicle" type="button">Clear</button>
          </div>

          <!-- Pickup -->
          <div class="autocomplete-wrap">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s7-6 7-11a7 7 0 1 0-14 0c0 5 7 11 7 11Z" stroke="currentColor" stroke-width="2"/>
                <path d="M12 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_pickup" placeholder="From: address, airport, hotel‚Ä¶" autocomplete="off" required />
            </div>
            <div id="h_pickup_list" class="autocomplete-list" role="listbox" aria-label="Pickup suggestions"></div>
          </div>

          <!-- Dropoff -->
          <div id="heroDropoffWrap" class="autocomplete-wrap">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s7-6 7-11a7 7 0 1 0-14 0c0 5 7 11 7 11Z" stroke="currentColor" stroke-width="2"/>
                <path d="M12 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_dropoff" placeholder="To: address, airport, hotel‚Ä¶" autocomplete="off" required />
            </div>
            <div id="h_dropoff_list" class="autocomplete-list" role="listbox" aria-label="Dropoff suggestions"></div>
          </div>

          <div class="row2">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 2v3M17 2v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 9h18" stroke="currentColor" stroke-width="2"/>
                <path d="M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_date" type="date" required />
            </div>

            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 8v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <select id="h_time" required></select>
            </div>
          </div>

          <div id="heroTransferWrap" class="field" style="margin-top:10px">
            <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M3 11h18M6 11V7a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M7 20a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM17 20a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <select id="h_transfer">
              <option value="point" selected>City / Point-to-point</option>
              <option value="airport">Airport transfer</option>
            </select>
          </div>

          <div id="heroHoursWrap" class="field" style="display:none; margin-top:10px">
            <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 8v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <select id="h_hours">
              <option value="1">1 hour</option>
              <option value="2">2 hours</option>
              <option value="3">3 hours</option>
              <option value="4">4 hours</option>
              <option value="5">5 hours</option>
              <option value="6">6 hours</option>
              <option value="7">7 hours</option>
              <option value="8">8 hours</option>
              <option value="9">9 hours</option>
              <option value="10">10 hours</option>
              <option value="11">11 hours</option>
              <option value="12">12 hours</option>
            </select>
          </div>

          
          <div id="gmap" class="gmap" aria-label="Map preview"><div id="gmap-loading" style="display:flex;align-items:center;justify-content:center;height:100%;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#6b7280;">Loading map‚Ä¶</div></div>

          <div id="routeInfo" class="route-info" aria-live="polite">
            <div class="ri-row"><span>Distance</span><strong id="riDistance">‚Äî</strong></div>
            <div class="ri-row"><span>Estimated time</span><strong id="riDuration">‚Äî</strong></div>
            <div class="ri-row"><span>Starts from</span><strong id="riPrice">‚Äî</strong></div>
            <div class="ri-badges" id="riBadges"></div>
          </div>

<div class="note">Professional chauffeur ‚Ä¢ clean premium vehicles.</div>

          <button id="heroSearchBtn" class="search-btn" type="submit">Choose vehicle</button>
          <div id="heroAlert" class="alert bad"></div>
        </form>
      </div>
    </aside>
  </div>
</div>

<!-- STEP 2: Vehicle selection -->
<div id="overlayVehicles" class="overlay" aria-hidden="true">
  <div class="overlay-top">
    <div class="container">
      <div class="overlay-title">Mont Tremblant Limo ‚Ä¢ Booking</div>
      <button class="overlay-close" type="button" onclick="closeOverlay('overlayVehicles', true)">Close</button>
    </div>
  </div>
  <div class="overlay-body">
    <div class="flow-wrap">
      <div class="flow-steps">
        <span>Search</span> <span>‚Ä∫</span>
        <span class="on">Service Class</span> <span>‚Ä∫</span>
        <span>Checkout</span>
      </div>

      <div class="summary-pill" id="tripSummary"></div>

      <div class="flow-h1">Select a vehicle</div>
      <div class="flow-sub">Prices shown are estimates.</div>

      <div class="vlist" id="vehicleOverlayList"></div>

      <div class="flow-actions">
        <button class="btn" type="button" onclick="backToSearch()">Edit search</button>
        <button id="btnVehicleContinue" class="btn btn-primary" type="button" disabled onclick="goToCheckoutOverlay()">Continue</button>
      </div>
    </div>
  </div>
</div>

<!-- STEP 3: Checkout -->
<div id="overlayCheckout" class="overlay" aria-hidden="true">
  <div class="overlay-top">
    <div class="container">
      <div class="overlay-title">Mont Tremblant Limo ‚Ä¢ Checkout</div>
      <button class="overlay-close" type="button" onclick="closeOverlay('overlayCheckout', true)">Close</button>
    </div>
  </div>
  <div class="overlay-body">
    <div class="flow-wrap">
      <div class="flow-steps">
        <span>Search</span> <span>‚Ä∫</span>
        <span>Service Class</span> <span>‚Ä∫</span>
        <span class="on">Checkout</span>
      </div>

      <div class="summary-pill" id="checkoutSummary"></div>

      <div class="flow-h1">Your details</div>
      <div class="flow-sub">Enter your details. We will email you a ‚Äúrequest received‚Äù confirmation, then you can pay securely via Stripe.</div>

      <label for="c_name">Name</label>
      <input id="c_name" placeholder="Your name" />

      <label for="c_phone">Phone</label>
      <input id="c_phone" placeholder="+1 ..." />

      <label for="c_email">Email</label>
      <input id="c_email" placeholder="you@example.com" />

      <label for="c_passengers">Passengers (optional)</label>
      <input id="c_passengers" type="number" min="1" max="50" placeholder="e.g., 2" inputmode="numeric" />

      <label for="c_luggage">Luggage (optional)</label>
      <input id="c_luggage" type="number" min="0" max="50" placeholder="e.g., 2" inputmode="numeric" />

      <label for="c_notes">Notes (optional)</label>
      <textarea id="c_notes" placeholder="Passengers, luggage, flight #, stops‚Ä¶"></textarea>

      <div class="estimate-box" style="margin-top:14px;">
        <div class="estimate-top">
          <b>Total estimate</b>
          <div class="estimate-value" id="checkoutTotal">‚Äî</div>
        </div>
        <div class="estimate-sub" id="checkoutSub"></div>
      </div>

      <div class="flow-actions" style="margin-top:14px;">
        <button class="btn" type="button" onclick="backToVehicles()">Back</button>
        <button class="btn btn-primary" type="button" onclick="startStripeCheckoutFromOverlay()">Pay with Stripe</button>
        <button class="btn" type="button" onclick="sendWhatsAppFromOverlay()">WhatsApp</button>
      </div>

      <div class="tinyhint" id="checkoutStatus" style="margin-top:10px;"></div>
    </div>
  </div>
</div>

<main class="container">
  <section id="fleet" class="section">
    <h2>Our Fleet</h2>
    <p class="subtitle">Premium vehicles for Mont-Tremblant travel. <b>Minimum 1 hour (hourly)</b> applies to all vehicles.</p>

    <div class="grid3">
      <div class="card">
        <div class="card-media"><img src="/escalade.jpg" alt="2026 Cadillac Escalade ESV black"></div>
        <div class="card-body">
          <h3>2026 Cadillac Escalade ESV</h3>
          <div class="meta">Ultra-luxury ‚Ä¢ VIP airport transfers ‚Ä¢ ski trips</div>
          <div class="price">$150 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="escalade" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="escalade" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="/suburban.jpg" alt="2025 Chevrolet Suburban black"></div>
        <div class="card-body">
          <h3>2025 Chevrolet Suburban</h3>
          <div class="meta">Spacious ‚Ä¢ luggage friendly ‚Ä¢ long rides</div>
          <div class="price">$100 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="suburban" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="suburban" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="/denali.jpg" alt="2026 GMC Yukon Denali black"></div>
        <div class="card-body">
          <h3>2026 GMC Yukon Denali</h3>
          <div class="meta">Premium comfort ‚Ä¢ smooth ride ‚Ä¢ executive travel</div>
          <div class="price">$100 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="denali" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="denali" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="/qx60.jpg" alt="2024 Infiniti QX60 black"></div>
        <div class="card-body">
          <h3>2024 Infiniti QX60</h3>
          <div class="meta">Comfort + value ‚Ä¢ airport transfers ‚Ä¢ city rides</div>
          <div class="price">$75 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="qx60" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="qx60" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="/tesla.jpg" alt="2023 Tesla Model Y black"></div>
        <div class="card-body">
          <h3>2023 Tesla Model Y</h3>
          <div class="meta">Quiet ‚Ä¢ modern ‚Ä¢ eco-friendly</div>
          <div class="price">$75 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="tesla" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="tesla" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="/sprinter.jpg" alt="Black Mercedes Sprinter van"></div>
        <div class="card-body">
          <h3>Mercedes Sprinter (Group Van)</h3>
          <div class="meta">Groups ‚Ä¢ events ‚Ä¢ ski luggage</div>
          <div class="price">$299 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="sprinter" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="sprinter" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  
  <section id="contact" class="section">
    <h2 data-i18n="contact_title">Contact Us</h2>
    <p class="subtitle" data-i18n="contact_sub">Questions, bookings, or custom trips ‚Äî contact us anytime.</p>

    <div class="contact-grid">
      <div class="contact-card">
        <h3 data-i18n="contact_getintouch">Get in touch</h3>

        <p>
          <svg width="18" height="18" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px">
            <path d="M4 4h16v16H4z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M4 6l8 7 8-7" fill="none" stroke="currentColor" stroke-width="2"/>
          </svg>

          <a href="mailto:info@monttremblantlimoservices.com?subject=Booking%20Request&body=Hello%20Mont%20Tremblant%20Limo%20Services,%0D%0A%0D%0AI%20would%20like%20to%20book%20a%20ride.%0D%0A%0D%0APickup:%0D%0ADropoff:%0D%0ADate:%0D%0ATime:%0D%0APassengers:%0D%0A%0D%0AThank%20you.">
            info@monttremblantlimoservices.com
          </a>
        </p>

        <p>üìû <a href="tel:+14383203733">+1 (438) 320-3733</a></p>

        <p data-i18n="contact_avail">Available 24/7</p>
      </div>

      <div class="contact-card">
        <h3 data-i18n="contact_sendmsg">Send us a message</h3>

        <input id="cf_name" placeholder="Your name" data-i18n-placeholder="ph_name">
        <input id="cf_email" placeholder="Your email" data-i18n-placeholder="ph_email">
        <textarea id="cf_message" placeholder="Your message" data-i18n-placeholder="ph_message"></textarea>

        <button class="btn btn-primary" type="button" onclick="sendContactEmail()" data-i18n="contact_sendbtn">Send Message</button>
      </div>
    </div>
</section>


  <footer>
    <div class="container footer-grid">
      <div>
        <strong data-i18n="footer_brand">Mont Tremblant Limo Services</strong><br>
        <span data-i18n="footer_tagline">Luxury chauffeur service in Mont-Tremblant</span>
      </div>

      <div>
        <strong data-i18n="footer_contact">Contact</strong><br>
        <a href="mailto:info@monttremblantlimoservices.com?subject=Booking%20Request">
          info@monttremblantlimoservices.com
        </a><br>
        <a href="tel:+14383203733">+1 (438) 320-3733</a>
      </div>

      <div>
        ¬© <span id="year"></span> <span data-i18n="footer_rights">All rights reserved</span>
      </div>
    </div>
  </footer>
</main>

<a class="whatsapp-float" href="https://wa.me/14383203733" target="_blank" rel="noreferrer">WhatsApp</a>

<div class="contact-bar">
  <a href="tel:+14383203733" data-i18n="sticky_call">Call</a>
  <a href="mailto:info@monttremblantlimoservices.com?subject=Booking%20Request" data-i18n="sticky_email">Email</a>
  <a href="https://wa.me/14383203733" target="_blank" rel="noreferrer" data-i18n="sticky_whatsapp">WhatsApp</a>
</div>

<script>

  document.getElementById("year").textContent = new Date().getFullYear();

  const BUSINESS_WA = "14383203733";

  const LOCAL_RATES = [
    { id:"escalade", name:"2026 Cadillac Escalade ESV", hourly:150, perKm:0.50, minPrice:150, meta:"Ultra-luxury ‚Ä¢ VIP airport transfers ‚Ä¢ ski trips", img:"/escalade.jpg" },
    { id:"suburban", name:"2025 Chevrolet Suburban", hourly:100, perKm:0.50, minPrice:120, meta:"Spacious ‚Ä¢ luggage friendly ‚Ä¢ long rides", img:"/suburban.jpg" },
    { id:"denali", name:"2026 GMC Yukon Denali", hourly:100, perKm:0.50, minPrice:120, meta:"Premium comfort ‚Ä¢ smooth ride ‚Ä¢ executive travel", img:"/denali.jpg" },
    { id:"qx60", name:"2024 Infiniti QX60", hourly:75, perKm:0.50, minPrice:99, meta:"Comfort + value ‚Ä¢ airport transfers ‚Ä¢ city rides", img:"/qx60.jpg" },
    { id:"tesla", name:"2023 Tesla Model Y", hourly:75, perKm:0.25, minPrice:75, meta:"Quiet ‚Ä¢ modern ‚Ä¢ eco-friendly", img:"/tesla.jpg" },
    { id:"sprinter", name:"Mercedes Sprinter (Group Van)", hourly:299, perKm:0.00, minPrice:299, meta:"Groups ‚Ä¢ events ‚Ä¢ ski luggage", img:"/sprinter.jpg" }
  ];

  // expose for map pricing script
  window.LOCAL_RATES = LOCAL_RATES;

  const state = {
    mode: "one_way",
    pickup: "",
    dropoff: "",
    date: "",
    time: "",
    transfer: "point",
    hours: 1,
    preferredVehicleId: null,
    selectedVehicleId: null,
    computedVehicles: [],
    pickup_lat: "",
    pickup_lng: "",
    dropoff_lat: "",
    dropoff_lng: ""
  };

  function $(id){ return document.getElementById(id); }
  function val(id){ return ($(id)?.value || "").trim(); }

  function formatMoney(n, currency){
    if (!Number.isFinite(Number(n))) return "‚Äî";
    const cur = (currency || "CAD").toUpperCase();
    const prefix = (cur === "USD") ? "US$" : "CA$";
    return prefix + Math.round(Number(n));
  }

  function getRouteNumbers(){
    const distanceM = Number(document.getElementById("h_distance_m")?.value || 0);
    const durationS = Number(document.getElementById("h_duration_s")?.value || 0);
    return {
      distanceM: Number.isFinite(distanceM) ? distanceM : 0,
      durationS: Number.isFinite(durationS) ? durationS : 0
    };
  }

  function vehiclePriceEstimate(vehicleId, distanceM, durationS){
    const v = LOCAL_RATES.find(x=>x.id===vehicleId);
    if (!v) return 0;

    const minPrice = Number(v.minPrice || 0);

    // Hourly mode: bill selected hours (min 3 hours)
    if (state.mode === "hourly"){
      const h = Math.max(3, Number(state.hours || 3));
      return Math.round(Math.max(minPrice, v.hourly * h));
    }

    // Point-to-point / airport: travel time + per-km, then apply vehicle minimum price
    const km = (distanceM || 0) / 1000;
    const travelHours = (durationS || 0) / 3600;

    const perKm = Number(v.perKm || 0);
    const total = (travelHours * v.hourly) + (km * perKm);

    return Math.round(Math.max(minPrice, total));
  }

  function buildTimeOptions(stepMinutes = 5, selectId, dateId = null){
    const timeEl = document.getElementById(selectId);
    if (!timeEl || timeEl.tagName !== "SELECT") return;

    timeEl.innerHTML = "";
    const ph = document.createElement("option");
    ph.value = "";
    ph.textContent = "Select time";
    ph.selected = true;
    ph.disabled = true;
    timeEl.appendChild(ph);

    const pad = (n)=> String(n).padStart(2,"0");
    for (let minutes = 0; minutes < 24 * 60; minutes += stepMinutes){
      const hh = Math.floor(minutes / 60);
      const mm = minutes % 60;
      const value = `${pad(hh)}:${pad(mm)}`;
      const hour12 = ((hh + 11) % 12) + 1;
      const ampm = hh < 12 ? "AM" : "PM";
      const label = `${hour12}:${pad(mm)} ${ampm}`;
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = label;
      timeEl.appendChild(opt);
    }
    const leadMinutes = 120; // require at least 2 hours lead time for same-day pickups
    const now = new Date();
    const todayStr = now.toISOString().slice(0,10);
    const dateEl = dateId ? document.getElementById(dateId) : null;
    const selectedDate = (dateEl && dateEl.value) ? dateEl.value : todayStr;
    const isToday = selectedDate === todayStr;

    let minMins = 0;
    if (isToday){
      minMins = now.getHours() * 60 + now.getMinutes() + leadMinutes;
      minMins = Math.ceil(minMins / stepMinutes) * stepMinutes;
    }

    let firstEnabled = null;
    for (let i = 1; i < timeEl.options.length; i++){
      const opt = timeEl.options[i];
      const [oh, om] = opt.value.split(":").map(Number);
      const optMins = (oh * 60) + om;
      if (isToday && optMins < minMins){
        opt.disabled = true;
      } else {
        opt.disabled = false;
        if (!firstEnabled) firstEnabled = opt;
      }
    }

    if (firstEnabled){
      timeEl.value = firstEnabled.value;
    } else {
      timeEl.value = "";
    }
  }

  function clearAutocompleteList(listEl){
    if (!listEl) return;
    listEl.innerHTML = "";
    listEl.style.display = "none";
  }

  function renderAutocompleteList(listEl, items, onPick){
    if (!listEl) return;
    listEl.innerHTML = "";
    if (!items.length){
      listEl.style.display = "none";
      return;
    }

    items.forEach((item)=>{
      const btn = document.createElement("button");
      btn.type = "button";
      btn.innerHTML = `${item.main}<span class="muted">${item.sub}</span>`;
      btn.addEventListener("mousedown", (e)=>{
        e.preventDefault();
        onPick(item);
        clearAutocompleteList(listEl);
      });
      listEl.appendChild(btn);
    });

    listEl.style.display = "block";
  }

  // ‚úÖ Airport code + airport name lookup (works without Google keys)
  const AIRPORTS = [
    { code:"YUL", name:"Montr√©al‚ÄìTrudeau International Airport", city:"Montr√©al (Dorval), QC", country:"Canada", lat:45.4706, lng:-73.7408 },
    { code:"YMX", name:"Montr√©al‚ÄìMirabel International Airport", city:"Mirabel, QC", country:"Canada", lat:45.6795, lng:-74.0387 },
    { code:"YHU", name:"Montr√©al Saint-Hubert Longueuil Airport", city:"Longueuil, QC", country:"Canada", lat:45.5175, lng:-73.4169 },
    { code:"YYZ", name:"Toronto Pearson International Airport", city:"Toronto, ON", country:"Canada", lat:43.6777, lng:-79.6248 },
    { code:"YOW", name:"Ottawa International Airport", city:"Ottawa, ON", country:"Canada", lat:45.3225, lng:-75.6692 },
    { code:"YQB", name:"Qu√©bec City Jean Lesage International Airport", city:"Qu√©bec City, QC", country:"Canada", lat:46.7911, lng:-71.3933 },
    { code:"JFK", name:"John F. Kennedy International Airport", city:"New York, NY", country:"USA", lat:40.6413, lng:-73.7781 },
    { code:"EWR", name:"Newark Liberty International Airport", city:"Newark, NJ", country:"USA", lat:40.6895, lng:-74.1745 },
    { code:"LGA", name:"LaGuardia Airport", city:"New York, NY", country:"USA", lat:40.7769, lng:-73.8740 },
    { code:"BOS", name:"Boston Logan International Airport", city:"Boston, MA", country:"USA", lat:42.3656, lng:-71.0096 }
  ];

  function normalize(s){ return String(s || "").trim().toUpperCase(); }

  function findAirportSuggestions(query){
    const q = normalize(query);
    if (!q) return [];

    // If user types exactly 3 letters, treat as IATA first
    const looksLikeIATA = /^[A-Z]{3}$/.test(q);
    const tokens = q.split(/\s+/).filter(Boolean);

    const matches = AIRPORTS.filter(a=>{
      if (looksLikeIATA) return a.code === q;
      // allow searching by code anywhere ("YUL airport"), or by name/city
      const hay = `${a.code} ${a.name} ${a.city} ${a.country}`.toUpperCase();
      return tokens.every(t => hay.includes(t));
    }).slice(0, 6);

    return matches.map(a=>({
      type: "airport",
      main: `${a.name} (${a.code})`,
      sub: `${a.code} ‚Ä¢ ${a.city} ‚Ä¢ ${a.country}`,
      value: `${a.name} (${a.code}), ${a.city}`,
      lat: a.lat,
      lng: a.lng
    }));
  }

  // ‚úÖ Better "street address" rendering using Photon properties
  function formatPhotonFeature(f){
    const p = f.properties || {};
    const g = f.geometry || {};
    const coords = Array.isArray(g.coordinates) ? g.coordinates : null;
    const lng = coords ? coords[0] : null;
    const lat = coords ? coords[1] : null;

    const housenumber = p.housenumber || "";
    const street = p.street || "";
    const name = p.name || "";

    const line1 = (housenumber || street)
      ? [housenumber, street].filter(Boolean).join(" ")
      : (name || p.locality || p.city || p.country || "Address");

    const city = p.city || p.locality || "";
    const region = p.state || p.region || "";
    const postcode = p.postcode || "";
    const country = p.country || "";
    const subParts = [city, region, postcode, country].filter(Boolean);
    const sub = subParts.join(", ") || "Select this address";

    const valueParts = [line1, city, region, postcode, country].filter(Boolean);
    const value = valueParts.join(", ");

    return {
      type: "address",
      main: line1,
      sub,
      value,
      lat: (typeof lat === "number" ? lat : null),
      lng: (typeof lng === "number" ? lng : null)
    };
  }

  async function fetchAddressSuggestions(query){
    let q = (query || "").trim();
    if (q.length < 3) return [];

    // light normalization (people often type "four season" instead of "four seasons")
    q = q.replace(/\bfour\s+season\b/i, "four seasons");

    const centerLat = 45.5019;     // Montr√©al
    const centerLon = -73.5674;

    // Prefer the Ottawa ‚Üî Montr√©al ‚Üî Qu√©bec City corridor, but DO NOT hard-restrict results
    const viewbox = "-76.50,46.90,-70.40,44.70"; // left,top,right,bottom

    const photonUrl =
      `https://photon.komoot.io/api/?q=${encodeURIComponent(q)}&limit=8&lang=en` +
      `&lat=${centerLat}&lon=${centerLon}`;

    const nominatimUrl =
      `https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&limit=8` +
      `&countrycodes=ca&viewbox=${viewbox}&q=${encodeURIComponent(q)}`;

    const formatNominatim = (r)=>{
      const a = r.address || {};
      const lat = r.lat ? Number(r.lat) : null;
      const lng = r.lon ? Number(r.lon) : null;

      const line1 = r.name || r.display_name?.split(",")[0] || "Address";
      const city = a.city || a.town || a.village || a.municipality || "";
      const region = a.state || a.province || "";
      const postcode = a.postcode || "";
      const country = a.country || "Canada";

      const sub = [city, region, postcode, country].filter(Boolean).join(", ") || (r.display_name || "Select this address");
      const value = r.display_name || [line1, city, region, postcode, country].filter(Boolean).join(", ");

      return { type:"address", main: line1, sub, value, lat, lng };
    };

    try{
      const [nomRes, phoRes] = await Promise.allSettled([
        fetch(nominatimUrl, { headers: { "Accept":"application/json" } }),
        fetch(photonUrl,    { headers: { "Accept":"application/json" } })
      ]);

      let nomItems = [];
      if (nomRes.status === "fulfilled" && nomRes.value && nomRes.value.ok){
        const arr = await nomRes.value.json().catch(()=>[]);
        if (Array.isArray(arr)) nomItems = arr.map(formatNominatim);
      }

      let phoItems = [];
      if (phoRes.status === "fulfilled" && phoRes.value && phoRes.value.ok){
        const data = await phoRes.value.json().catch(()=>({}));
        const feats = Array.isArray(data.features) ? data.features : [];
        phoItems = feats.map(formatPhotonFeature);
      }

      const merged = [];
      const seen = new Set();
      const add = (it)=>{
        const k = (it.value || "").toLowerCase();
        if (!k || seen.has(k)) return;
        seen.add(k);
        merged.push(it);
      };

      // Nominatim first (better for POIs), then Photon (good for street addresses)
      nomItems.forEach(add);
      phoItems.forEach(add);

      // rank local/Qu√©bec higher (but keep others as fallback)
      const score = (it)=>{
        const t = `${it.main||""} ${it.sub||""} ${it.value||""}`.toLowerCase();
        let s = 0;
        if (t.includes("montreal") || t.includes("montr√©al")) s += 50;
        if (t.includes("quebec") || t.includes("qu√©bec") || t.includes("qc")) s += 20;
        if (t.includes("laval")) s += 8;
        if (t.includes("ottawa")) s += 6;
        if (t.includes("canada")) s += 3;
        return -s; // sort ascending
      };

      return merged.sort((a,b)=> score(a)-score(b)).slice(0, 8);
    }catch(_e){
      return [];
    }
  }

  function setCoords(latId, lngId, lat, lng){
    const latEl = $(latId);
    const lngEl = $(lngId);
    if (latEl) latEl.value = (lat ?? "");
    if (lngEl) lngEl.value = (lng ?? "");
  }

  function clearCoords(latId, lngId){
    setCoords(latId, lngId, "", "");
  }

  // --- Google Places custom suggestions (uses your existing dropdown UI) ---
let __acService = null;
let __placesService = null;

function getServices(){
  if (!window.google || !google.maps || !google.maps.places) return null;
  if (!__acService) __acService = new google.maps.places.AutocompleteService();
  if (!__placesService){
    const map = ensureMap();
    __placesService = new google.maps.places.PlacesService(map || document.createElement("div"));
  }
  return { ac: __acService, ps: __placesService };
}

function qcBiasOptions(){
  // Center Montreal
  return {
    location: new google.maps.LatLng(45.5019, -73.5674),
    radius: 50000, // 50km
  };
}

async function fetchGoogleSuggestions(query){
  const svc = getServices();
  if (!svc) return [];
  return new Promise((resolve) => {
    svc.ac.getPlacePredictions(
      {
        input: query,
        componentRestrictions: { country: ["ca","us"] },
        locationBias: getQcCorridorBounds(),
        ...qcBiasOptions()
      },
      (preds, status) => {
        if (status !== google.maps.places.PlacesServiceStatus.OK || !preds) return resolve([]);
        const items = preds.slice(0, 6).map(p => ({
          main: p.structured_formatting?.main_text || p.description,
          sub: p.structured_formatting?.secondary_text || "",
          value: p.description,
          place_id: p.place_id
        }));
        resolve(items);
      }
    );
  });
}

function pickGooglePlace(item, input, latId, lngId, kind){
  const svc = getServices();
  if (!svc || !item.place_id) return;
  svc.ps.getDetails(
    { placeId: item.place_id, fields: ["name","formatted_address","geometry"] },
    (place, status) => {
      if (status !== google.maps.places.PlacesServiceStatus.OK || !place || !place.geometry) return;
      const addr = place.formatted_address || place.name || item.value;
      input.value = addr;
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();
      setCoords(latId, lngId, lat, lng);
      setMarker(kind, lat, lng, place.name || addr);
      try { updateRouteAndEstimate(); } catch(e) {}
    }
  );
}

function setupAutocomplete(inputId, listId, latId, lngId){
    const input = $(inputId);
    const list = $(listId);
    if (!input || !list) return;

    let timer = null;
    let token = 0;

    const onPick = (item)=>{
      input.value = item.value;
      setCoords(latId, lngId, item.lat, item.lng);
      if (window.google && google.maps) setMarker((inputId.includes('pickup')||inputId.includes('from'))?'pickup':'dropoff', item.lat, item.lng, item.value);
      try { updateRouteAndEstimate(); } catch(e) {}

    };

    const doSearch = async ()=>{
      const q = input.value.trim();
      if (q.length < 2){
        clearAutocompleteList(list);
        return;
      }

      // If Google Places is enabled, use Google predictions (faster + better results)
      if (window.googlePlacesEnabled && window.google && google.maps && google.maps.places){
        const items = await fetchGoogleSuggestions(q);
        renderAutocompleteList(list, items, (it)=>pickGooglePlace(it, input, latId, lngId, (inputId.includes('pickup')||inputId.includes('from'))?'pickup':'dropoff'));
        return;
      }


      const current = ++token;

      // Airports first (so typing YUL instantly works)
      const airportItems = findAirportSuggestions(q);

      // Addresses second (street addresses / hotels / POIs)
      const addressItems = (q.length >= 3) ? await fetchAddressSuggestions(q) : [];

      if (current !== token) return;

      // de-dupe by value
      const seen = new Set();
      const merged = [];
      [...airportItems, ...addressItems].forEach(it=>{
        const k = (it.value || "").toLowerCase();
        if (!k || seen.has(k)) return;
        seen.add(k);
        merged.push(it);
      });

      renderAutocompleteList(list, merged.slice(0, 8), onPick);
    };

    input.addEventListener("input", ()=>{
      
      // Google Places enabled: keep using our custom dropdown (doSearch).
// if user edits manually after choosing a suggestion, clear coordinates
      clearCoords(latId, lngId);

      if (timer) clearTimeout(timer);
      timer = setTimeout(doSearch, 80);
    });

    input.addEventListener("blur", ()=> setTimeout(()=> clearAutocompleteList(list), 60));
    input.addEventListener("focus", () => {
      // New session improves relevance and speed
      if (window.google && window.google.maps && window.google.maps.places) newSessionToken();
      
      // Google Places enabled: keep using our custom dropdown (doSearch).
if (input.value.trim().length >= 2) doSearch();
    });

    // close list on Esc
    input.addEventListener("keydown", (e)=>{
      if (e.key === "Escape") clearAutocompleteList(list);
    });
  }

  function setHeroMode(mode){
    state.mode = mode;
    $("heroMode").value = mode;

    const one = mode === "one_way";
    $("tabOneWay").classList.toggle("active", one);
    $("tabHourly").classList.toggle("active", !one);

    $("heroDropoffWrap").style.display = one ? "" : "none";
    $("heroTransferWrap").style.display = one ? "" : "none";
    $("heroHoursWrap").style.display = one ? "none" : "";

    $("h_dropoff").required = one;
  }

  function setPreferredVehicle(vehicleId){
    state.preferredVehicleId = vehicleId || null;
    const vehicle = LOCAL_RATES.find(v=>v.id === state.preferredVehicleId);
    const banner = $("selectedVehicleBanner");
    const nameEl = $("selectedVehicleName");
    const imageEl = $("selectedVehicleImage");
    if (!banner || !nameEl) return;
    if (vehicle){
      nameEl.textContent = vehicle.name;
      if (imageEl){
        imageEl.src = vehicle.img;
        imageEl.alt = vehicle.name;
      }
      banner.style.display = "flex";
    }else{
      nameEl.textContent = "";
      if (imageEl){
        imageEl.src = "";
        imageEl.alt = "";
      }
      banner.style.display = "none";
    }
  }

  function showHeroAlert(message){
    const el = $("heroAlert");
    el.style.display = "block";
    el.textContent = message;
  }
  function clearHeroAlert(){
    const el = $("heroAlert");
    el.style.display = "none";
    el.textContent = "";
  }

  function validateHero(){
    if (!val("h_pickup")) return "Please enter a pickup location.";
    if (state.mode === "one_way" && !val("h_dropoff")) return "Please enter a destination.";
    if (!$("h_date").value) return "Please choose a date.";
    if (!val("h_time")) return "Please choose a time.";
    return null;
  }

  function calcVehicleTotal(vehicle){
    const { distanceM, durationS } = getRouteNumbers();
    return vehiclePriceEstimate(vehicle.id, distanceM, durationS);
  }

  function buildVehiclesForTrip(){
    const ORDER = ["escalade","suburban","denali","qx60","tesla","sprinter"];
    const list = LOCAL_RATES.map(v=>{
      const total = calcVehicleTotal(v);
      const note = state.mode === "hourly"
        ? `Total ${formatMoney(total)} for ${Math.max(1, Number(state.hours || 3))} hours`
        : (state.transfer === "airport" ? "Airport estimate" : "Point-to-point estimate");
      return { ...v, total, note };
    });
    list.sort((a,b)=>ORDER.indexOf(a.id) - ORDER.indexOf(b.id));
    return list;
  }

  let __scrollY = 0;
  function lockBodyScroll(){
    __scrollY = window.scrollY || 0;
    document.body.style.position = "fixed";
    document.body.style.top = `-${__scrollY}px`;
    document.body.style.left = "0";
    document.body.style.right = "";
    document.body.style.width = "100%";
  }
  function unlockBodyScroll(){
    document.body.style.position = "";
    document.body.style.top = "";
    document.body.style.left = "";
    document.body.style.right = "";
    document.body.style.width = "";
    window.scrollTo(0, __scrollY);
  }

  function anyOverlayOpen(){
    return !!document.querySelector(".overlay.show");
  }

  function closeAllOverlaysVisual(){
    document.querySelectorAll(".overlay.show").forEach(el=>{
      el.classList.remove("show");
      el.setAttribute("aria-hidden","true");
    });
    document.documentElement.classList.remove("overlay-open");
    unlockBodyScroll();
    try{
      if (window.Tawk_API && typeof window.Tawk_API.showWidget === "function") {
        window.Tawk_API.showWidget();
      }
    }catch(e){}
  }

  function syncFlowBarHeight(overlayId){
    const overlay = document.getElementById(overlayId);
    if (!overlay) return;
    const bar = overlay.querySelector(".flow-actions");
    if (!bar) return;
    const h = Math.ceil(bar.getBoundingClientRect().height);
    if (h > 0) document.documentElement.style.setProperty("--flowbar-h", h + "px");
  }

  function syncViewportHeight(){
    const vh = (window.visualViewport?.height || window.innerHeight || 0);
    if (vh) document.documentElement.style.setProperty("--vh", vh + "px");
  }

  function forceIOSPaint(overlayId){
    const overlay = document.getElementById(overlayId);
    if (!overlay) return;

    const body = overlay.querySelector(".overlay-body");
    const bar  = overlay.querySelector(".flow-actions");

    if (overlay) void overlay.offsetHeight;
    if (body) void body.offsetHeight;
    if (bar) void bar.offsetHeight;

    if (body){
      const y = body.scrollTop;
      body.scrollTop = y + 1;
      body.scrollTop = y;
    }

    if (bar){
      const prev = bar.style.display;
      bar.style.display = "none";
      void bar.offsetHeight;
      bar.style.display = prev || "";
      void bar.offsetHeight;

      bar.style.transform = "translateZ(0)";
      bar.style.webkitTransform = "translateZ(0)";
    }
  }

  function scheduleIOSPaint(overlayId){
    forceIOSPaint(overlayId);
    requestAnimationFrame(()=>forceIOSPaint(overlayId));
    setTimeout(()=>forceIOSPaint(overlayId), 50);
    setTimeout(()=>forceIOSPaint(overlayId), 150);
    setTimeout(()=>forceIOSPaint(overlayId), 350);
  }

  function openOverlay(id, pushHistory = true){
    lockBodyScroll();
    document.documentElement.classList.add("overlay-open");

    const el = $(id);
    el.classList.add("show");
    el.setAttribute("aria-hidden","false");

    try{
      if (window.Tawk_API && typeof window.Tawk_API.hideWidget === "function") {
        window.Tawk_API.hideWidget();
      }
    }catch(e){}

    if (pushHistory){
      history.pushState({ overlay: id }, "", "#" + id);
    }

    syncFlowBarHeight(id);
    scheduleIOSPaint(id);
  }

  function closeOverlay(id, popHistory = false){
    const el = $(id);
    el.classList.remove("show");
    el.setAttribute("aria-hidden","true");

    if (!anyOverlayOpen()){
      document.documentElement.classList.remove("overlay-open");
      unlockBodyScroll();
      try{
        if (window.Tawk_API && typeof window.Tawk_API.showWidget === "function") {
          window.Tawk_API.showWidget();
        }
      }catch(e){}
      if (location.hash === "#overlayVehicles" || location.hash === "#overlayCheckout"){
        history.replaceState({ page: "home" }, "", location.pathname + location.search);
      }
    }

    if (popHistory && history.state && history.state.overlay){
      history.back();
    }
  }

  window.addEventListener("popstate", (e)=>{
    closeAllOverlaysVisual();
    if (e.state && e.state.overlay){
      openOverlay(e.state.overlay, false);
    }
  });

  window.addEventListener("resize", ()=>{
    syncViewportHeight();
    if (document.getElementById("overlayVehicles")?.classList.contains("show")) syncFlowBarHeight("overlayVehicles");
    if (document.getElementById("overlayCheckout")?.classList.contains("show")) syncFlowBarHeight("overlayCheckout");
  });
  window.visualViewport?.addEventListener("resize", syncViewportHeight);
  window.visualViewport?.addEventListener("scroll", syncViewportHeight);

  function backToSearch(){ history.back(); }
  function backToVehicles(){ history.back(); }

  function renderTripSummary(){
    const when = `${state.date} at ${state.time}`;
    const route = state.mode === "hourly"
      ? `${state.pickup} ‚Üí Hourly (Mont-Tremblant area)`
      : `${state.pickup} ‚Üí ${state.dropoff}`;

    $("tripSummary").innerHTML = `
      <div><b>${when}</b></div>
      <small>${route}</small>
    `;
  }

  function clearRowBorderHelpers(){
    document.querySelectorAll(".vrow").forEach(r=> r.classList.remove("hide-top-border"));
  }
  function applyRowBorderHelpers(selectedRow){
    clearRowBorderHelpers();
    if (!selectedRow) return;
    selectedRow.classList.add("hide-top-border");
    const next = selectedRow.nextElementSibling;
    if (next && next.classList.contains("vrow")) next.classList.add("hide-top-border");
  }

  function renderVehiclesOverlay(){
    const wrap = $("vehicleOverlayList");
    wrap.innerHTML = "";
    state.selectedVehicleId = null;
    $("btnVehicleContinue").disabled = true;

    const hours = Math.max(1, Number(state.hours || 3));
    let preferredRow = null;

    state.computedVehicles.forEach(v=>{
      const row = document.createElement("div");
      row.className = "vrow";
      row.dataset.vehicleId = v.id;

      const underVehicle = (state.mode === "hourly") ? "" : `<small>${v.note}</small>`;
      const underPrice = (state.mode === "hourly")
        ? `<small style="display:block;margin-top:2px;color:rgba(11,18,32,.62);font-weight:800;">Total ${formatMoney(v.total)} for ${hours} hours</small>`
        : `<small style="display:block;margin-top:2px;color:rgba(11,18,32,.62);font-weight:800;">${v.note}</small>`;

      row.innerHTML = `
        <img class="veh-img" src="${v.img}" alt="${v.name}" />
        <div class="vleft">
          <b>${v.name}</b>
          ${underVehicle}
        </div>
        <div class="vright">
          <div>${formatMoney(v.total)}</div>
          ${underPrice}
        </div>
        <div class="vcheck" aria-hidden="true">‚úì</div>
      `;

      row.addEventListener("click", ()=>{
        document.querySelectorAll(".vrow").forEach(x=>x.classList.remove("selected"));
        row.classList.add("selected");
        state.selectedVehicleId = v.id;
        $("btnVehicleContinue").disabled = false;
        applyRowBorderHelpers(row);
        syncFlowBarHeight("overlayVehicles");
        scheduleIOSPaint("overlayVehicles");
      });

      wrap.appendChild(row);
      if (state.preferredVehicleId && state.preferredVehicleId === v.id) preferredRow = row;
    });

    if (preferredRow){
      preferredRow.click();
      preferredRow.scrollIntoView({ block: "center" });
    }

    syncFlowBarHeight("overlayVehicles");
    scheduleIOSPaint("overlayVehicles");
  }

  function getChosenVehicle(){
    return state.computedVehicles.find(v=>v.id === state.selectedVehicleId) || null;
  }

  function goToCheckoutOverlay(){
    if (!state.selectedVehicleId) return;

    closeOverlay("overlayVehicles", false);

    const chosen = getChosenVehicle();
    const when = `${state.date} at ${state.time}`;
    const route = state.mode === "hourly"
      ? `${state.pickup} ‚Üí Hourly (Mont-Tremblant area)`
      : `${state.pickup} ‚Üí ${state.dropoff}`;

    $("checkoutSummary").innerHTML = `
      <div><b>${when}</b></div>
      <small>${route} ‚Ä¢ ${chosen?.name || ""}</small>
    `;

    $("checkoutTotal").textContent = chosen ? formatMoney(chosen.total) : "‚Äî";
    $("checkoutSub").textContent = chosen
      ? (state.mode === "hourly"
          ? `Total ${formatMoney(chosen.total)} for ${Math.max(3, Number(state.hours || 3))} hours`
          : chosen.note)
      : "";

    openOverlay("overlayCheckout", true);
    syncFlowBarHeight("overlayCheckout");
  }

  function buildWhatsAppMessage(payload){
    const lines = [];
    lines.push("Booking Request - Mont Tremblant Limo Services");
    lines.push(`Name: ${payload.name || ""}`);
    if (payload.phone) lines.push(`Phone: ${payload.phone}`);
    lines.push(`Date: ${payload.date}`);
    lines.push(`Time: ${payload.time}`);
    lines.push(`Pickup: ${payload.pickup}`);
    lines.push(`Drop-off: ${payload.dropoff}`);
    lines.push(`Trip type: ${payload.triptype}`);
    lines.push(`Vehicle: ${payload.vehicle}`);
    lines.push(`Estimate: ${payload.estimate_text}`);
    if (payload.notes) lines.push(`Notes: ${payload.notes}`);
    return encodeURIComponent(lines.join("\n"));
  }

  function sendWhatsAppFromOverlay(){
    const chosen = getChosenVehicle();
    if (!chosen) return;

    const name = val("c_name");
    const phone = val("c_phone");
    const notes = val("c_notes");
    const triptype = (state.mode === "hourly") ? "Hourly" : (state.transfer === "airport" ? "Airport transfer" : "Point-to-point");

    const estimateText = (state.mode === "hourly")
      ? `Total ${formatMoney(chosen.total)} for ${Math.max(3, Number(state.hours || 3))} hours`
      : `${formatMoney(chosen.total)} (${chosen.note})`;

    const payload = {
      name, phone,
      date: state.date,
      time: state.time,
      pickup: state.pickup,
      dropoff: (state.mode === "hourly") ? "Mont-Tremblant (area)" : state.dropoff,
      triptype,
      vehicle: chosen.name,
      estimate_text: estimateText,
      notes
    };

    window.open("https://wa.me/" + BUSINESS_WA + "?text=" + buildWhatsAppMessage(payload), "_blank", "noreferrer");
  }

    function getTripCurrency(){
    const pc = (val("h_pickup_country") || "").toUpperCase();
    const dc = (val("h_dropoff_country") || "").toUpperCase();
    return (pc === "US" || dc === "US") ? "USD" : "CAD";
  }

  async function startStripeCheckoutFromOverlay(){
    const statusEl = $("checkoutStatus");
    statusEl.textContent = "";

    const chosen = getChosenVehicle();
    if (!chosen){
      statusEl.textContent = "Please choose a vehicle first.";
      return;
    }

    const name = val("c_name");
    if (!name){
      statusEl.textContent = "Please enter your name.";
      return;
    }

    const email = val("c_email");
    const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email || "");
    if (!emailOk){
      statusEl.textContent = "Please enter a valid email address.";
      return;
    }

    const phone = val("c_phone");

    // Hourly: min 1 hour
    const hoursNum = Math.max(1, Number(state.hours || 3));
    const currency = getTripCurrency();

    // Build database booking payload (for /api/bookings)
    const dbBooking = {
      mode: (state.mode === "hourly") ? "hourly" : "one_way",
      pickup_text: state.pickup || "",
      dropoff_text: (state.mode === "hourly") ? null : (state.dropoff || ""),
      pickup_lat: Number(val("h_pickup_lat") || 0) || null,
      pickup_lng: Number(val("h_pickup_lng") || 0) || null,
      dropoff_lat: Number(val("h_dropoff_lat") || 0) || null,
      dropoff_lng: Number(val("h_dropoff_lng") || 0) || null,
      pickup_airport: val("h_pickup_airport") || null,
      dropoff_airport: val("h_dropoff_airport") || null,

      pickup_datetime: new Date(`${state.date}T${state.time}:00`).toISOString(),
      hours: (state.mode === "hourly") ? hoursNum : null,

      distance_m: Number(val("h_distance_m") || 0) || null,
      duration_s: Number(val("h_duration_s") || 0) || null,

      currency: currency,
      vehicle_key: chosen.id,
      price_estimate: Number(chosen.total) || 0,

      customer_name: name,
      customer_email: email,
      customer_phone: phone || null,
      passengers: Number(val("c_passengers") || 0) || null,
      luggage: Number(val("c_luggage") || 0) || null,
      notes: val("c_notes") || null
    };

    // Build Stripe checkout payload (kept compatible with your existing endpoint)
    const checkoutBooking = {
      booking_id: null, // will be filled after DB insert
      name: name,
      email: email,
      phone: phone,
      currency: currency,
      date: state.date,
      time: state.time,
      pickup: state.pickup,
      dropoff: (state.mode === "hourly") ? "Mont-Tremblant (area)" : state.dropoff,
      triptype: (state.mode === "hourly") ? "hourly" : (state.transfer === "airport" ? "airport" : "point"),
      vehicle: chosen.name,
      vehicle_id: chosen.id,
      hours: String(hoursNum),
      roundtrip: "no",
      notes: val("c_notes"),
      estimate_text: (state.mode === "hourly")
        ? `Total ${formatMoney(chosen.total, currency)} for ${hoursNum} hour${hoursNum>1?"s":""}`
        : `${formatMoney(chosen.total, currency)} (${chosen.note})`,
      estimate_total: chosen.total,
      estimate_total_cad: chosen.total,
      pay_option: "full",
      pay_now: chosen.total,
      pay_now_cad: chosen.total
    };

    try{
      statusEl.textContent = "Saving your booking‚Ä¶";

      // 1) Save booking + send emails
      const saveRes = await fetch("/api/bookings", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(dbBooking)
      });
      const saveData = await saveRes.json().catch(()=> ({}));
      if (!saveRes.ok || !saveData?.ok) throw new Error(saveData?.error || "Unable to save booking.");
      checkoutBooking.booking_id = saveData.id;

      // 2) Start Stripe checkout (if endpoint exists)
      statusEl.textContent = "Starting secure checkout‚Ä¶";
      const res = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(checkoutBooking)
      });

      const data = await res.json().catch(()=> ({}));
      if (!res.ok) {
        // If Stripe endpoint isn't configured yet, show success message with booking ID
        statusEl.textContent = `Booking saved (ID: ${checkoutBooking.booking_id}). Payment setup is pending.`;
        alert(`Booking saved! Your booking ID is ${checkoutBooking.booking_id}. We'll contact you to confirm and take payment.`);
        return;
      }
      if (!data?.url) throw new Error("Missing checkout URL from server.");
      window.location.href = data.url;

    }catch(err){
      console.error(err);
      statusEl.textContent = "Checkout error: " + (err.message || "Unknown error");
      alert("Checkout error: " + (err.message || "Unknown error"));
    }
  }

  function setHeroSearchLoading(isLoading){
    const btn = $("heroSearchBtn");
    btn.disabled = isLoading;
    btn.textContent = isLoading ? "Loading‚Ä¶" : "Choose vehicle";
  }

  $("tabOneWay").addEventListener("click", ()=> setHeroMode("one_way"));
  $("tabHourly").addEventListener("click", ()=> setHeroMode("hourly"));
  $("clearSelectedVehicle").addEventListener("click", ()=> setPreferredVehicle(null));

  document.querySelectorAll(".reserve-btn").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.preventDefault();
      const vehicleId = btn.dataset.vehicle;
      const mode = btn.dataset.mode || "one_way";
      const url = new URL(window.location.href);
      url.searchParams.set("vehicle", vehicleId);
      url.searchParams.set("mode", mode);
      url.hash = "booking";
      window.location.href = url.toString();
    });
  });

  $("heroSearchForm").addEventListener("submit", (e)=>{
    e.preventDefault();
    clearHeroAlert();

    const err = validateHero();
    if (err) return showHeroAlert(err);

    // Collect latest inputs
    state.pickup = val("h_pickup");
    state.dropoff = val("h_dropoff");
    state.date = $("h_date").value;
    state.time = val("h_time");
    state.transfer = val("h_transfer") || "point";
    state.hours = Math.max(1, Number(val("h_hours") || 1));

    // capture coords (if user picked from suggestions)
    state.pickup_lat = val("h_pickup_lat");
    state.pickup_lng = val("h_pickup_lng");
    state.dropoff_lat = val("h_dropoff_lat");
    state.dropoff_lng = val("h_dropoff_lng");

    setHeroSearchLoading(true);

    try {
      state.computedVehicles = buildVehiclesForTrip();
      renderTripSummary();
      renderVehiclesOverlay();
      openOverlay("overlayVehicles", true);
    } catch (ex) {
      console.error("Choose vehicle failed:", ex);
      showHeroAlert("Something went wrong while loading vehicles. Please refresh and try again.");
    } finally {
      setHeroSearchLoading(false);
    }
  });

  window.addEventListener("load", ()=>{
    if (!history.state){
      history.replaceState({ page: "home" }, "", location.pathname + location.search + (location.hash || ""));
    }

    syncViewportHeight();
    buildTimeOptions(5, "h_time", "h_date");

    const dateEl = document.getElementById("h_date");
    if (dateEl){
      const todayStr = new Date().toISOString().slice(0,10);
      dateEl.min = todayStr;
      if (!dateEl.value) dateEl.value = todayStr;
      dateEl.addEventListener("change", ()=> buildTimeOptions(5, "h_time", "h_date"));
    }

    // ‚úÖ Works for both one-way + hourly (pickup) and one-way dropoff
    setupAutocomplete("h_pickup", "h_pickup_list", "h_pickup_lat", "h_pickup_lng");
    setupAutocomplete("h_dropoff", "h_dropoff_list", "h_dropoff_lat", "h_dropoff_lng");

    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    $("h_date").value = `${yyyy}-${mm}-${dd}`;

    const params = new URLSearchParams(window.location.search);
    const preferredVehicle = params.get("vehicle");
    const preferredMode = params.get("mode");
    if (preferredVehicle){
      setHeroMode(preferredMode || "one_way");
      setPreferredVehicle(preferredVehicle);
      window.__estimateVehicleId = preferredVehicle;
      document.getElementById("booking")?.scrollIntoView({ behavior: "smooth", block: "start" });
      setTimeout(()=> $("h_pickup")?.focus(), 300);
    }else{
      setHeroMode("one_way");
      setPreferredVehicle(null);
      window.__estimateVehicleId = "escalade";
    }
    document.getElementById("year").textContent = yyyy;

    if (location.hash === "#overlayVehicles") openOverlay("overlayVehicles", false);
    if (location.hash === "#overlayCheckout") openOverlay("overlayCheckout", false);
  });

</script>

<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6987db032260861c350b5c0a/default';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->


<!-- Google Places + Map (optional) -->
<script>
/**
 * Paste your real key below.
 * Keep it restricted in Google Cloud Console (HTTP referrer + only Places API + Maps JavaScript API).
 */
const GOOGLE_MAPS_BROWSER_KEY = "AIzaSyB1v_rHuYsxchwEIrY6a4_v3PU3XH5zrp8"; // paste your browser key here

window.googlePlacesEnabled = false;
let gMap = null;
let pickupMarker = null;
let dropoffMarker = null;
let directionsService = null;
let directionsRenderer = null;

// Known airports (add more anytime)
const KNOWN_AIRPORTS = [
  { code: "YUL", name: "Montr√©al‚ÄìTrudeau International Airport", lat: 45.457714, lng: -73.749908 },
  { code: "YOW", name: "Ottawa International Airport", lat: 45.3225, lng: -75.6692 },
  { code: "YTZ", name: "Toronto Billy Bishop Airport", lat: 43.6275, lng: -79.3962 },
  { code: "YYZ", name: "Toronto Pearson International Airport", lat: 43.6777, lng: -79.6248 }
];

// Pricing knobs (point-to-point estimate)
const PRICING = {
  base: 25,        // CAD
  perKm: 2.40,     // CAD per km
  perMin: 0.55,    // CAD per minute
  minFare: 95,     // minimum booking estimate
  airportSurcharge: 15
};

function haversineKm(lat1, lon1, lat2, lon2){
  const R = 6371;
  const toRad = (d)=> d * Math.PI / 180;
  const dLat = toRad(lat2-lat1);
  const dLon = toRad(lon2-lon1);
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
  return 2 * R * Math.asin(Math.sqrt(a));
}

function detectAirport(lat, lng){
  let best = null;
  let bestKm = Infinity;
  for (const a of KNOWN_AIRPORTS){
    const km = haversineKm(lat, lng, a.lat, a.lng);
    if (km < bestKm){
      bestKm = km;
      best = a;
    }
  }
  // within ~2.5km counts as airport pickup/dropoff
  if (best && bestKm <= 2.5) return best;
  return null;
}

function fmtDistance(m){
  if (!Number.isFinite(m)) return "‚Äî";
  const km = m/1000;
  return km >= 10 ? `${km.toFixed(0)} km` : `${km.toFixed(1)} km`;
}
function fmtDuration(s){
  if (!Number.isFinite(s)) return "‚Äî";
  const min = Math.round(s/60);
  const h = Math.floor(min/60);
  const m = min%60;
  if (h <= 0) return `${m} min`;
  return `${h}h ${m}m`;
}
function roundTo(x, step){
  return Math.round(x/step)*step;
}
function computePrice(distanceM, durationS, pickupAirport, dropoffAirport){
  // Step 1 should show "Starts from" using Tesla pricing (as requested)
  try{
    const vId = "tesla";
    if (typeof vehiclePriceEstimate === "function") {
      return vehiclePriceEstimate(vId, distanceM||0, durationS||0);
    }
  }catch(e){}
  // Fallback (shouldn't happen)
  const km = (distanceM||0)/1000;
  const travelHours = (durationS||0)/3600;
  return Math.round((travelHours*75) + (km*0.25));
}

function setRouteUI({distanceM=null, durationS=null, price=null, badges=[]}={}){
  const dEl = document.getElementById("riDistance");
  const tEl = document.getElementById("riDuration");
  const pEl = document.getElementById("riPrice");
  const bEl = document.getElementById("riBadges");
  if (dEl) dEl.textContent = (distanceM==null? "‚Äî" : fmtDistance(distanceM));
  if (tEl) tEl.textContent = (durationS==null? "‚Äî" : fmtDuration(durationS));
  if (pEl) pEl.textContent = (price==null? "‚Äî" : `CA$${Number(price).toFixed(0)}`);
  if (bEl){
    bEl.innerHTML = "";
    (badges||[]).forEach((txt)=>{
      const chip = document.createElement("div");
      chip.className = "ri-badge";
      chip.textContent = txt;
      bEl.appendChild(chip);
    });
  }
}

function ensureDirections(){
  const map = ensureMap();
  if (!map || !window.google || !google.maps) return null;
  if (!directionsService) directionsService = new google.maps.DirectionsService();
  if (!directionsRenderer){
    directionsRenderer = new google.maps.DirectionsRenderer({
      map,
      suppressMarkers: true,
      preserveViewport: true
    });
  } else {
    directionsRenderer.setMap(map);
  }
  return { directionsService, directionsRenderer };
}

function getLatLngFromHidden(prefix){
  const lat = Number((document.getElementById(`h_${prefix}_lat`)||{}).value);
  const lng = Number((document.getElementById(`h_${prefix}_lng`)||{}).value);
  if (!Number.isFinite(lat) || !Number.isFinite(lng)) return null;
  return { lat, lng };
}

function updateRouteAndEstimate(){
  const p = getLatLngFromHidden("pickup");
  const d = getLatLngFromHidden("dropoff");
  if (!p || !d){
    // Clear route UI when incomplete
    setRouteUI({distanceM:null, durationS:null, price:null, badges:[]});
    const dr = document.getElementById("h_distance_m"); if (dr) dr.value = "";
    const du = document.getElementById("h_duration_s"); if (du) du.value = "";
    const pe = document.getElementById("h_price_estimate"); if (pe) pe.value = "";
    return;
  }

  // Airport detection
  const pA = detectAirport(p.lat, p.lng);
  const dA = detectAirport(d.lat, d.lng);
  const badges = [];
  if (pA) badges.push(`Pickup: ${pA.code}`);
  if (dA) badges.push(`Dropoff: ${dA.code}`);
  const hPA = document.getElementById("h_pickup_airport"); if (hPA) hPA.value = pA ? pA.code : "";
  const hDA = document.getElementById("h_dropoff_airport"); if (hDA) hDA.value = dA ? dA.code : "";

  const ds = ensureDirections();
  if (!ds) return;

  ds.directionsService.route(
    {
      origin: p,
      destination: d,
      travelMode: google.maps.TravelMode.DRIVING
    },
    (result, status) => {
      if (status !== "OK" || !result || !result.routes || !result.routes[0] || !result.routes[0].legs || !result.routes[0].legs[0]){
        console.warn("Directions failed:", status);
        setRouteUI({distanceM:null, durationS:null, price:null, badges});
        return;
      }
      ds.directionsRenderer.setDirections(result);

      const leg = result.routes[0].legs[0];
      const distanceM = leg.distance ? leg.distance.value : null;
      const durationS = leg.duration ? leg.duration.value : null;

      const price = computePrice(distanceM||0, durationS||0, !!pA, !!dA);
      setRouteUI({distanceM, durationS, price, badges});

      const dr = document.getElementById("h_distance_m"); if (dr) dr.value = String(distanceM ?? "");
      const du = document.getElementById("h_duration_s"); if (du) du.value = String(durationS ?? "");
      const pe = document.getElementById("h_price_estimate"); if (pe) pe.value = String(price ?? "");
    }
  );
}


function ensureMap(){
  try{
    if (!window.google || !google.maps || typeof google.maps.Map !== "function") return null;
  const el = document.getElementById("gmap");
  if (!el) return null;
  if (gMap) return gMap;

  // Default center near Montreal
  gMap = new google.maps.Map(el, {
    center: { lat: 45.5019, lng: -73.5674 },
    zoom: 10,
    mapTypeControl: false,
    streetViewControl: false,
    fullscreenControl: false,
  });
  const ld=document.getElementById('gmap-loading'); if(ld) ld.style.display='none';
  return gMap;
  }catch(e){ console.warn("ensureMap failed", e); return null; }
}

function setMarker(kind, lat, lng, title){
  const map = ensureMap();
  if (!map) return;

  const pos = { lat, lng };
  map.panTo(pos);

  const markerOptions = { position: pos, map, title: title || "" };
  if (kind === "pickup"){
    if (pickupMarker) pickupMarker.setMap(null);
    pickupMarker = new google.maps.Marker(markerOptions);
  } else {
    if (dropoffMarker) dropoffMarker.setMap(null);
    dropoffMarker = new google.maps.Marker(markerOptions);
  }

  // If both are set, fit bounds
  if (pickupMarker && dropoffMarker){
    const bounds = new google.maps.LatLngBounds();
    bounds.extend(pickupMarker.getPosition());
    bounds.extend(dropoffMarker.getPosition());
    map.fitBounds(bounds, 60);
  } else {
    map.setZoom(13);
  }

  // Update route estimate if both endpoints exist
  try { updateRouteAndEstimate(); } catch(e) {}
}

function findBookingInputs() {
  // Prefer the hero booking inputs used on this page
  const byId = (id) => document.getElementById(id);

  const pickup =
    byId("h_pickup") ||
    byId("pickup") || byId("from") || byId("fromInput") || byId("pickupInput") ||
    document.querySelector('input[placeholder*="Pick up" i]') ||
    document.querySelector('input[placeholder*="Pickup" i]') ||
    document.querySelector('input[placeholder*="From" i]') ||
    document.querySelector('input[aria-label*="From" i]') ||
    document.querySelector('input[name*="from" i]') ||
    document.querySelectorAll("input[type=text]")[0];

  const dropoff =
    byId("h_dropoff") ||
    byId("dropoff") || byId("to") || byId("toInput") || byId("dropoffInput") ||
    document.querySelector('input[placeholder*="Drop" i]') ||
    document.querySelector('input[placeholder*="To" i]') ||
    document.querySelector('input[aria-label*="To" i]') ||
    document.querySelector('input[name*="to" i]') ||
    document.querySelectorAll("input[type=text]")[1];

  return { pickup, dropoff };
}



function getQcCorridorBounds(){
  // Broad bounds covering Canada + USA (bias only; not strict)
  const sw = new google.maps.LatLng(24.396308, -168.0); // southern US, west (incl. Alaska)
  const ne = new google.maps.LatLng(83.1139, -52.0);   // northern Canada, east
  return new google.maps.LatLngBounds(sw, ne);
}

function wireAutocomplete(){
  // Prevent double-wiring
  if (window.__placesWired) return;



  if (!window.google || !google.maps || !google.maps.places) return;

  const { pickup: pickupInput, dropoff: dropoffInput } = findBookingInputs();
  if (pickupInput) pickupInput.setAttribute('data-which','pickup');
  if (dropoffInput) dropoffInput.setAttribute('data-which','dropoff');
if (!pickupInput || !dropoffInput) return;

  const options = {
    componentRestrictions: { country: ["ca","us"] },
    bounds: getQcCorridorBounds(),
    strictBounds: false,
    fields: ["name", "formatted_address", "geometry"]
  };

  const pickupAC = new google.maps.places.Autocomplete(pickupInput, options);
  
tuneAutocomplete(pickupAC);
const dropoffAC = new google.maps.places.Autocomplete(dropoffInput, options);

  
tuneAutocomplete(dropoffAC);

  pickupAC.addListener("place_changed", () => {
    const p = pickupAC.getPlace();
    if (!p || !p.geometry) return;

    const lat = p.geometry.location.lat();
    const lng = p.geometry.location.lng();

    const display = p.name ? (p.formatted_address ? `${p.name}, ${p.formatted_address}` : p.name) : (p.formatted_address || "");
    if (display) pickupInput.value = display;

    const hLat = document.getElementById("h_pickup_lat");
    const hLng = document.getElementById("h_pickup_lng");
    if (hLat) hLat.value = lat;
    if (hLng) hLng.value = lng;

    // Clear your custom list if present
    const list = document.getElementById("h_pickup_list");
    if (list) list.innerHTML = "";

    setMarker("pickup", lat, lng, display);
    try { updateRouteAndEstimate(); } catch(e) {}
  });

  dropoffAC.addListener("place_changed", () => {
    const p = dropoffAC.getPlace();
    if (!p || !p.geometry) return;

    const lat = p.geometry.location.lat();
    const lng = p.geometry.location.lng();

    const display = p.name ? (p.formatted_address ? `${p.name}, ${p.formatted_address}` : p.name) : (p.formatted_address || "");
    if (display) dropoffInput.value = display;

    const hLat = document.getElementById("h_dropoff_lat");
    const hLng = document.getElementById("h_dropoff_lng");
    if (hLat) hLat.value = lat;
    if (hLng) hLng.value = lng;

    const list = document.getElementById("h_dropoff_list");
    if (list) list.innerHTML = "";

    setMarker("dropoff", lat, lng, display);
    try { updateRouteAndEstimate(); } catch(e) {}
  });
  // Re-enable inputs now that Google Places is ready.
  try {
    pickupInput.disabled = false;
    dropoffInput.disabled = false;

    // Restore placeholders if we temporarily changed them during script load.
    [pickupInput, dropoffInput].forEach((el) => {
      if (!el) return;
      if (el.dataset && el.dataset.prevPlaceholder !== undefined) {
        el.setAttribute("placeholder", el.dataset.prevPlaceholder || "");
        delete el.dataset.prevPlaceholder;
      } else if ((el.getAttribute("placeholder") || "").includes("Loading Google suggestions")) {
        el.setAttribute("placeholder", "");
      }
      if (el.dataset) delete el.dataset.placesPending;
    });


    // If the user typed before Places finished loading, nudging focus will cause suggestions to appear immediately.
    const nudge = (el) => {
      if (!el) return;
      const v = (el.value || "").trim();
      if (v.length < 2) return;
      setTimeout(() => {
        try {
          const wasActive = (document.activeElement === el);
          if (wasActive) el.blur();
          el.focus();
        } catch(e) {}
      }, 0);
    };
    nudge(pickupInput);
    nudge(dropoffInput);
  } catch(e) {}

  window.googlePlacesEnabled = true;
  window.__placesWired = true;

  
  // Initialize map immediately (prevents blank map area)
  try { ensureMap(); } catch(e) {}
// Make sure the map initializes even before selecting
  ensureMap();
}


function restoreInputs() {
  try {
    const { pickup: _p, dropoff: _d } = findBookingInputs();
    [_p, _d].forEach((el) => {
      if (!el) return;
      el.disabled = false;
      // restore placeholder if we temporarily changed it
      if (el.dataset && el.dataset.prevPlaceholder !== undefined) {
        el.setAttribute("placeholder", el.dataset.prevPlaceholder || "");
        delete el.dataset.prevPlaceholder;
      } else if ((el.getAttribute("placeholder") || "").includes("Loading Google suggestions")) {
        // safety fallback
        el.setAttribute("placeholder", "");
      }
      if (el.dataset) delete el.dataset.placesPending;
    });
  } catch (e) {}
}


function loadGoogleMapsScript() {
  const el = document.getElementById("gmap-loading");

  // If key is missing, don't block the UI
  if (!GOOGLE_MAPS_BROWSER_KEY || GOOGLE_MAPS_BROWSER_KEY.includes("PASTE_")) {
    if (el) el.textContent = "Google Maps browser key not set ‚Äî using basic address search.";
    restoreInputs();
    return;
  }

  // If google + places already available, init immediately
  if (window.google && window.google.maps && window.google.maps.places) {
    try {
      ensureMap();
      wireAutocomplete();
    } catch (e) {
      console.warn("Google already loaded but init failed", e);
    } finally {
      restoreInputs();
    }
    return;
  }

  // If script tag already exists, don't add another ‚Äî but DO start a watchdog
  const existing = document.querySelector('script[data-google-maps="1"]');
  if (existing) {
    startPlacesWatchdog();
    return;
  }

  // Disable inputs until Places is ready
  try {
    const { pickup: _p, dropoff: _d } = findBookingInputs();
    [_p, _d].forEach((inp) => {
      if (!inp) return;
      inp.dataset.placesPending = "1";
      inp.dataset.prevPlaceholder = inp.getAttribute("placeholder") || "";
      inp.setAttribute("placeholder", "Loading Google suggestions...");
      inp.disabled = true;
    });
  } catch (e) {}

  // Google will call this when the JS API is ready
  window.__initGoogleMapsPlaces = () => {
    try {
      ensureMap();                 // create the map now that google exists
      wireAutocomplete();
    } catch (e) {
      console.warn("Google init failed", e);
    } finally {
      restoreInputs();             // always unlock
    }
  };

  const s = document.createElement("script");
  s.dataset.googleMaps = "1";
  s.async = true;
  s.defer = true;
  s.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(GOOGLE_MAPS_BROWSER_KEY)}&v=weekly&libraries=places&loading=async&callback=__initGoogleMapsPlaces`;

  // BACKSTOP: Safari sometimes doesn't fire callback reliably ‚Äî onload will
  s.onload = () => {
    try {
      // If callback didn't run, this will initialize map + autocomplete
      if (window.google && window.google.maps) {
        if (typeof window.__initGoogleMapsPlaces === "function") {
          window.__initGoogleMapsPlaces();
        } else {
          // At least render map
          ensureMap();
        }
      }
    } catch (e) {
      console.warn("Google onload init failed", e);
      restoreInputs();
    }
  };

  s.onerror = () => {
    console.warn("Google Maps failed to load (key/billing/referrer/APIs). Falling back.");
    if (el) el.textContent = "Map failed to load ‚Äî using basic address search.";
    restoreInputs();               // IMPORTANT: unlock on failure
  };

  document.head.appendChild(s);

  // WATCHDOG: never allow ‚ÄúLoading Google suggestions‚Ä¶‚Äù to stay forever
  startPlacesWatchdog();

  function startPlacesWatchdog() {
    window.__placesWatchdogStarted = window.__placesWatchdogStarted || false;
    if (window.__placesWatchdogStarted) return;
    window.__placesWatchdogStarted = true;

    setTimeout(() => {
      const { pickup: _p, dropoff: _d } = findBookingInputs();
      const pending =
        (_p && _p.dataset && _p.dataset.placesPending) ||
        (_d && _d.dataset && _d.dataset.placesPending);

      if (!pending) return;

      if (window.google && window.google.maps && window.google.maps.places) {
        try {
          if (typeof window.__initGoogleMapsPlaces === "function") window.__initGoogleMapsPlaces();
        } catch (e) {
          restoreInputs();
        }
      } else {
        if (el) el.textContent = "Google Places not available ‚Äî using basic address search.";
        restoreInputs();
      }
    }, 6000);
  }
}

// Load after DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  // Disable inputs briefly until Google Places wiring is ready.
  // This prevents the "type, no suggestions, click again" behavior when users type before Places finishes loading.
  try {
    const { pickup, dropoff } = findBookingInputs();
    if (pickup) pickup.disabled = true;
    if (dropoff) dropoff.disabled = true;
  } catch(e) {}

  // Mobile keyboard UX
  try {
    const { pickup, dropoff } = findBookingInputs();
    [pickup, dropoff].forEach((el)=>{
      if (!el) return;
      el.setAttribute("inputmode","search");
      el.setAttribute("enterkeyhint","next");
      el.setAttribute("autocapitalize","none");
      el.setAttribute("autocomplete","off");
      el.setAttribute("autocorrect","off");
      el.setAttribute("spellcheck","false");
    });
  } catch(e) {}

  // Initial UI state
  try { setRouteUI({distanceM:null, durationS:null, price:null, badges:[]}); } catch(e) {}

  ensureMap();         // show the empty map area (placeholder background if Google not loaded)
  loadGoogleMapsScript();
});
</script>

<script>
// --- Autocomplete tuning (faster + more accurate) ---
function tuneAutocomplete(ac) {
  if (!ac) return;
  // Restrict results to Canada (remove if you want worldwide)
  ac.setComponentRestrictions({ country: ["ca","us"] });
  // Ask only for what we need (reduces payload and speeds response)
  if (ac.setFields) ac.setFields(["place_id", "formatted_address", "geometry", "name"]);
  // Prefer establishments (hotels/businesses) + addresses
  // Leave types unrestricted so hotels/businesses + addresses both appear
}
// --- Google Places performance helpers ---
// --- Server-backed Places (fast with Vercel caching) ---
let __acAbort = null;

async function fetchPredictions(query) {
  const q = (query || "").trim();
  if (q.length < 2) return [];
  const ck = q.toLowerCase();
  const cached = cacheGet(ck);
  if (cached) return cached;

  try {
    if (__acAbort) __acAbort.abort();
    __acAbort = new AbortController();

    const r = await fetch(`/api/places-autocomplete?q=${encodeURIComponent(q)}`, { signal: __acAbort.signal });
    if (!r.ok) return [];
    const data = await r.json();
    const preds = (data.predictions || []).map(p => ({
      place_id: p.place_id,
      description: p.description,
      structured_formatting: p.structured_formatting
    }));
    cacheSet(ck, preds);
    return preds;
  } catch (e) {
    if (e && e.name === "AbortError") return [];
    console.warn("autocomplete fetch failed", e);
    return [];
  }
}

async function fetchPlaceDetails(placeId) {
  if (!placeId) return null;
  try {
    const r = await fetch(`/api/place-details?placeId=${encodeURIComponent(placeId)}`);
    if (!r.ok) return null;
    const data = await r.json();
    const result = data.result;
    if (!result || !result.geometry || !result.geometry.location) return null;
    return {
      name: result.name,
      formatted_address: result.formatted_address,
      lat: result.geometry.location.lat,
      lng: result.geometry.location.lng
    };
  } catch (e) {
    console.warn("place details fetch failed", e);
    return null;
  }
}
// --- Perceived speed helpers (instant UI) ---
const __lastPredictions = { pickup: [], dropoff: [] };
function showLoading(listEl){
  if (!listEl) return;
  listEl.innerHTML = '<div class="autocomplete-item" style="opacity:.7">Searching‚Ä¶</div>';
  listEl.style.display = "block";
}
function showInstantLast(which, listEl, inputEl){
  const preds = __lastPredictions[which] || [];
  if (preds.length) {
    // Render immediately while new request is in flight
    if (typeof renderSuggestions === "function") renderSuggestions(preds, listEl, inputEl);
    else if (typeof renderGoogleSuggestions === "function") renderGoogleSuggestions(preds, listEl, inputEl);
  } else {
    showLoading(listEl);
  }
}
const __placesCache = new Map(); // key -> {ts, preds}
const __CACHE_TTL_MS = 30_000;

function cacheGet(key){
  const v = __placesCache.get(key);
  if (!v) return null;
  if (Date.now() - v.ts > __CACHE_TTL_MS) { __placesCache.delete(key); return null; }
  return v.preds;
}
function cacheSet(key, preds){
  __placesCache.set(key, { ts: Date.now(), preds });
  // keep cache small
  if (__placesCache.size > 50) {
    const firstKey = __placesCache.keys().next().value;
    __placesCache.delete(firstKey);
  }
}

let __sessionToken = null;
function newSessionToken(){
  try { __sessionToken = new google.maps.places.AutocompleteSessionToken(); } catch(e) { __sessionToken = null; }
  return __sessionToken;
}

function getQcCorridorBounds(){
  // Broad bounds covering Canada + USA (bias only; not strict)
  const sw = new google.maps.LatLng(24.396308, -168.0); // southern US, west (incl. Alaska)
  const ne = new google.maps.LatLng(83.1139, -52.0);   // northern Canada, east
  return new google.maps.LatLngBounds(sw, ne);
}

</script>

<script>
  function sendContactEmail(){
    const name = document.getElementById("cf_name")?.value || "";
    const email = document.getElementById("cf_email")?.value || "";
    const message = document.getElementById("cf_message")?.value || "";

    const subject = "Customer Inquiry";
    const body =
`Hello Mont Tremblant Limo Services,

Name: ${name}
Email: ${email}

Message:
${message}

`;

    const mailto =
      "mailto:info@monttremblantlimoservices.com"
      + "?subject=" + encodeURIComponent(subject)
      + "&body=" + encodeURIComponent(body);

    window.location.href = mailto;
  }

  const I18N = {
    en: {
      nav_fleet: "Our fleet",
      nav_routes: "Destinations",
      nav_faq: "FAQ",
      nav_contact: "Contact",
      nav_whatsapp: "WhatsApp",

      hero_title: "Luxury chauffeur service in Mont-Tremblant",
      hero_sub: "Airport transfers, hourly bookings, ski trips, corporate travel and special events.",

      badge_247: "24/7 booking",
      badge_pro: "Professional chauffeurs",
      badge_premium: "Premium vehicles",
      badge_cities: "Mont-Tremblant ‚Ä¢ Montr√©al ‚Ä¢ Ottawa",

      contact_title: "Contact Us",
      contact_sub: "Questions, bookings, or custom trips ‚Äî contact us anytime.",
      contact_getintouch: "Get in touch",
      contact_sendmsg: "Send us a message",
      contact_sendbtn: "Send Message",
      contact_avail: "Available 24/7",

      ph_name: "Your name",
      ph_email: "Your email",
      ph_message: "Your message",

      footer_brand: "Mont Tremblant Limo Services",
      footer_tagline: "Luxury chauffeur service in Mont-Tremblant",
      footer_contact: "Contact",
      footer_rights: "All rights reserved",

      sticky_call: "Call",
      sticky_email: "Email",
      sticky_whatsapp: "WhatsApp"
    },

    fr: {
      nav_fleet: "Notre flotte",
      nav_routes: "Destinations",
      nav_faq: "FAQ",
      nav_contact: "Contact",
      nav_whatsapp: "WhatsApp",

      hero_title: "Service de chauffeur de luxe √† Mont-Tremblant",
      hero_sub: "Transferts a√©roport, r√©servations √† l‚Äôheure, sorties ski, voyages corporatifs et √©v√©nements sp√©ciaux.",

      badge_247: "R√©servation 24/7",
      badge_pro: "Chauffeurs professionnels",
      badge_premium: "V√©hicules haut de gamme",
      badge_cities: "Mont-Tremblant ‚Ä¢ Montr√©al ‚Ä¢ Ottawa",

      contact_title: "Nous joindre",
      contact_sub: "Questions, r√©servations ou trajets sur mesure ‚Äî contactez-nous √† tout moment.",
      contact_getintouch: "Contact",
      contact_sendmsg: "Envoyez-nous un message",
      contact_sendbtn: "Envoyer",
      contact_avail: "Disponible 24/7",

      ph_name: "Votre nom",
      ph_email: "Votre courriel",
      ph_message: "Votre message",

      footer_brand: "Mont Tremblant Limo Services",
      footer_tagline: "Service de chauffeur de luxe √† Mont-Tremblant",
      footer_contact: "Contact",
      footer_rights: "Tous droits r√©serv√©s",

      sticky_call: "Appeler",
      sticky_email: "Courriel",
      sticky_whatsapp: "WhatsApp"
    }
  };

  function applyLang(lang){
    const dict = I18N[lang] || I18N.en;

    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (dict[key]) el.textContent = dict[key];
    });

    document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
      const key = el.getAttribute("data-i18n-placeholder");
      if (dict[key]) el.setAttribute("placeholder", dict[key]);
    });

    document.querySelectorAll(".lang-btn").forEach(btn=>{
      const isOn = btn.dataset.lang === lang;
      btn.classList.toggle("active", isOn);
      btn.setAttribute("aria-pressed", isOn ? "true" : "false");
    });

    try { localStorage.setItem("mtls_lang", lang); } catch(e) {}
    document.documentElement.setAttribute("lang", lang);
  }

  function initLang(){
    let saved = null;
    try { saved = localStorage.getItem("mtls_lang"); } catch(e) {}

    const browser = (navigator.language || "en").toLowerCase();
    const guess = browser.startsWith("fr") ? "fr" : "en";

    applyLang(saved || guess);

    document.querySelectorAll(".lang-btn").forEach(btn=>{
      btn.addEventListener("click", ()=> applyLang(btn.dataset.lang));
    });
  }

  initLang();
</script>

</body>
</html>
