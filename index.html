<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Mont Tremblant Limo Services | Luxury Chauffeur</title>
<meta name="description" content="Luxury chauffeur service in Mont-Tremblant. Escalade, Suburban, Denali, QX60, Tesla & Sprinter. Minimum 3 hours. Call or WhatsApp +1 (514) 293-3170." />
<link rel="canonical" href="https://monttremblantlimoservices.com/" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"LocalBusiness",
  "name":"Mont Tremblant Limo Services",
  "url":"https://monttremblantlimoservices.com/",
  "telephone":"+1-514-293-3170",
  "description":"Luxury chauffeur service in Mont-Tremblant. Premium vehicles for airport transfers, hourly bookings, ski trips, corporate travel, and special events. Minimum 3 hours.",
  "areaServed":[
    {"@type":"City","name":"Mont-Tremblant"},
    {"@type":"City","name":"MontrÃ©al"},
    {"@type":"City","name":"Ottawa"},
    {"@type":"City","name":"QuÃ©bec City"},
    {"@type":"City","name":"New York"},
    {"@type":"City","name":"Boston"},
    {"@type":"AdministrativeArea","name":"New Jersey"}
  ],
  "address":{
    "@type":"PostalAddress",
    "addressLocality":"Mont-Tremblant",
    "addressRegion":"QC",
    "addressCountry":"CA"
  },
  "image":[ "https://monttremblantlimoservices.com/Tremblant.jpg" ],
  "sameAs":[ "https://wa.me/15142933170" ]
}
</script>

<style>
  :root{
    --bg:#ffffff;
    --ink:#0b1220;
    --muted: rgba(11,18,32,.68);
    --line: rgba(11,18,32,.10);
    --shadow: 0 18px 55px rgba(0,0,0,.14);
    --shadow2: 0 10px 28px rgba(0,0,0,.10);
    --radius: 16px;
    --max: 1160px;
    --gradA:#ff2e63;
    --gradB:#ff7a00;
    --good:#0f9d58;
    --bad:#b00020;

    --flowbar-h: 180px;
    --vh: 100vh;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html{scroll-behavior:smooth}
  body{
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: var(--bg);
    color: var(--ink);
    line-height: 1.6;
    font-size: 16px;
    overflow-x:hidden;
  }

  html, body{ width:100%; max-width:100%; overflow-x:hidden; }
  img, video, canvas, svg{ max-width:100%; height:auto; }

  a{color:inherit;text-decoration:none}
  .container{max-width:var(--max);margin:0 auto;padding: 0 18px}
  section{ scroll-margin-top: 96px; }
  main{padding-bottom: 64px}

  header{
    position: sticky;
    top:0;
    z-index:50;
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--line);
  }
  .nav{
    height: 76px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
    font-weight: 950;
    letter-spacing: .4px;
  }
  .logo{
    width: 38px; height: 38px;
    border-radius: 12px;
    background: #0b1220;
    color:#fff;
    display:grid;
    place-items:center;
    font-weight: 950;
  }
  .links{
    display:flex;
    align-items:center;
    gap: 12px;
    flex-wrap:wrap;
    justify-content:center;
  }
  .links a{
    color: rgba(11,18,32,.78);
    font-weight: 800;
    font-size: 14px;
    padding: 10px 10px;
    border-radius: 12px;
    transition: .15s ease;
  }
  .links a:hover{ background: rgba(11,18,32,.06); color: rgba(11,18,32,.92); }

  .header-actions{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .pill{
    display:none;
    font-size: 13px;
    color: rgba(11,18,32,.75);
    font-weight: 800;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid rgba(11,18,32,.12);
    background: rgba(255,255,255,.65);
    white-space:nowrap;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding: 11px 16px;
    border-radius: 999px;
    font-weight: 900;
    border: 1px solid rgba(11,18,32,.14);
    background: #fff;
    box-shadow: var(--shadow2);
    color: rgba(11,18,32,.92);
    transition: transform .15s ease, box-shadow .15s ease;
    cursor:pointer;
    white-space:nowrap;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow: 0 16px 34px rgba(0,0,0,.12); }
  .btn-primary{
    border: none;
    color:#fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    box-shadow: 0 18px 44px rgba(255,90,20,.22);
  }

  .hero-wrap{
    position:relative;
    border-bottom: 1px solid var(--line);
    background:
      linear-gradient(90deg, rgba(255,255,255,.55) 0%, rgba(255,255,255,.18) 45%, rgba(255,255,255,0) 72%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.12)),
      url("Tremblant.jpg") center/cover no-repeat;
  }
  .hero-inner{
    display:grid;
    grid-template-columns: 1.25fr .75fr;
    align-items: start;
    gap: 22px;
    padding: 26px 0 34px;
    min-height: 520px;
  }
  .hero-left{ padding: 0 18px; }
  .hero-title{
    font-size: clamp(34px, 4vw, 58px);
    line-height: 1.05;
    letter-spacing: -0.6px;
    font-weight: 950;
    color:#0b1220;
    max-width: 18ch;
    margin-top: 24px;
  }
  .hero-sub{
    margin-top: 12px;
    color: rgba(11,18,32,.74);
    font-size: 17px;
    max-width: 68ch;
    font-weight: 700;
  }
  .hero-badges{
    margin-top: 18px;
    display:flex;
    flex-wrap:wrap;
    gap: 10px;
  }
  .badge{
    padding: 9px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.75);
    border: 1px solid rgba(11,18,32,.10);
    color: rgba(11,18,32,.75);
    font-weight: 900;
    font-size: 13px;
    box-shadow: 0 10px 20px rgba(0,0,0,.06);
  }

  .booking-card{
    margin-right: 18px;
    justify-self:end;
    width: min(430px, 100%);
    border-radius: 14px;
    background: #fff;
    box-shadow: 0 28px 70px rgba(0,0,0,.24);
    border: 1px solid rgba(11,18,32,.10);
    overflow:hidden;
  }
  .tabs{
    display:flex;
    background: #fff;
    border-bottom: 1px solid rgba(11,18,32,.08);
  }
  .tab{
    flex:1;
    padding: 14px 14px;
    font-weight: 950;
    font-size: 14px;
    color: rgba(11,18,32,.78);
    background: #fff;
    border:none;
    cursor:pointer;
  }
  .tab.active{
    background: #f4f5f7;
    color: rgba(11,18,32,.94);
  }

  .book-body{ padding: 14px; background: #fff; }

  .stepbar{
    display:flex;
    gap: 8px;
    align-items:center;
    justify-content:space-between;
    margin: 6px 0 12px;
  }
  .stepdot{
    flex: 1;
    height: 6px;
    border-radius: 999px;
    background: rgba(11,18,32,.10);
    overflow:hidden;
    position:relative;
  }
  .stepdot > i{
    position:absolute; inset:0;
    width: 33%;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    border-radius: 999px;
  }
  .steptext{
    font-size: 12.5px;
    color: rgba(11,18,32,.65);
    font-weight: 900;
    white-space:nowrap;
    margin-left: 10px;
  }

  .field{
    display:flex;
    align-items:center;
    gap: 10px;
    padding: 12px 12px;
    border-radius: 10px;
    border: 1px solid rgba(11,18,32,.10);
    background: #f4f5f7;
    margin-bottom: 10px;
    min-width: 0;
  }
  .ico{ width: 18px; height: 18px; color: rgba(11,18,32,.55); flex:0 0 auto; }
  .field input, .field select{
    width:100%;
    border:none;
    outline:none;
    background: transparent;
    font-size: 16px;
    font-weight: 800;
    color: rgba(11,18,32,.90);
    min-width: 0;
  }
  .field input::placeholder{ color: rgba(11,18,32,.50); font-weight:800; }

  /* âœ… Autocomplete UI */
  .autocomplete-wrap{ position:relative; }
  .autocomplete-list{
    position:absolute;
    top: calc(100% - 8px);
    left:0;
    right:0;
    z-index:30;
    background:#fff;
    border:1px solid rgba(11,18,32,.12);
    border-radius: 12px;
    box-shadow: 0 16px 28px rgba(0,0,0,.12);
    display:none;
    max-height: 220px;
    overflow:auto;
  }
  .autocomplete-list button{
    width:100%;
    border:none;
    border-top:1px solid rgba(11,18,32,.08);
    background:#fff;
    text-align:left;
    padding: 10px 12px;
    font-size: 14px;
    font-weight:700;
    color: rgba(11,18,32,.84);
    cursor:pointer;
  }
  .autocomplete-list button:first-child{ border-top:none; }
  .autocomplete-list button:hover{ background: rgba(11,18,32,.04); }
  .autocomplete-list .muted{ color: rgba(11,18,32,.55); font-size:12px; display:block; margin-top:2px; }

  .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .note{ margin: 8px 4px 10px; color: rgba(11,18,32,.62); font-size: 12.8px; font-weight: 800; }

  .search-btn{
    width:100%;
    border:none;
    border-radius: 10px;
    padding: 13px 14px;
    font-weight: 950;
    font-size: 15px;
    color: #fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    cursor:pointer;
    box-shadow: 0 18px 44px rgba(255,90,20,.22);
  }
  .search-btn[disabled]{ opacity:.65; cursor:not-allowed; box-shadow:none; }

  .alert{
    display:none;
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fbfbfc;
    font-weight: 850;
    font-size: 13px;
  }
  .alert.bad{ border-color: rgba(176,0,32,.25); background: rgba(176,0,32,.06); color: var(--bad); }

  .overlay{
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: rgba(255,255,255,.96);
    display: none;
    overflow: hidden;
    overscroll-behavior: contain;
  }
  .overlay.show{ display: block; }

  .overlay-top{
    height: 76px;
    border-bottom: 1px solid rgba(11,18,32,.10);
    background: rgba(255,255,255,.92);
    backdrop-filter: blur(10px);
    display:flex;
    align-items:center;
  }
  .overlay-top .container{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    width: 100%;
  }
  .overlay-title{
    font-weight: 950;
    letter-spacing: .2px;
  }
  .overlay-close{
    border: 1px solid rgba(11,18,32,.14);
    background: #fff;
    border-radius: 12px;
    padding: 10px 12px;
    font-weight: 900;
    cursor: pointer;
  }

  .overlay-body{
    height: calc(var(--vh) - 76px);
    height: calc(-webkit-fill-available - 76px);
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    padding: 26px 0 calc(var(--flowbar-h) + env(safe-area-inset-bottom) + 16px);
    touch-action: pan-y;
  }

  .flow-wrap{
    max-width: 760px;
    width: 100%;
    margin: 0 auto;
    padding: 0 18px;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .flow-steps{
    display:flex;
    gap: 18px;
    align-items:center;
    justify-content:center;
    color: rgba(11,18,32,.55);
    font-weight: 900;
    font-size: 13px;
    margin-bottom: 14px;
    flex-wrap: wrap;
    text-align:center;
  }
  .flow-steps .on{ color: rgba(11,18,32,.92); }

  .summary-pill{
    border: 1px solid rgba(11,18,32,.12);
    border-radius: 16px;
    background: #fbfbfc;
    padding: 14px 16px;
    font-weight: 800;
    color: rgba(11,18,32,.82);
  }
  .summary-pill small{
    display:block;
    color: rgba(11,18,32,.62);
    font-weight: 800;
    margin-top: 4px;
  }

  .flow-h1{
    margin-top: 18px;
    font-size: 28px;
    line-height: 1.15;
    letter-spacing: -.2px;
    font-weight: 950;
  }
  .flow-sub{
    margin-top: 8px;
    color: rgba(11,18,32,.66);
    font-weight: 750;
  }

  .vlist{
    margin-top: 16px;
    border: 1px solid rgba(11,18,32,.12);
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
  }

  .vrow{
    position: relative;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 14px;
    padding: 14px 14px;
    border-top: 1px solid rgba(11,18,32,.10);
    cursor: pointer;
    transition: transform .12s ease, padding .12s ease, background .12s ease;
    min-width: 0;
  }
  .vrow:first-child{ border-top: none; }
  .vrow:hover{ background: rgba(11,18,32,.03); }

  .vcheck{
    position:absolute;
    right: 16px;
    top: 14px;
    width: 22px;
    height: 22px;
    border-radius: 999px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 13px;
    font-weight: 950;
    color: #fff;
    background: linear-gradient(90deg, var(--gradA), var(--gradB));
    box-shadow: 0 10px 18px rgba(255,90,20,.20);
    opacity: 0;
    transform: scale(.92);
    transition: opacity .12s ease, transform .12s ease;
    pointer-events:none;
  }

  .vrow.selected{
    background: rgba(255,90,20,.06);
    padding-top: 18px;
    padding-bottom: 18px;
    transform: translateY(-1px);
    z-index: 2;
  }
  .vrow.selected .vcheck{ opacity: 1; transform: scale(1); }
  .vrow.selected::after{
    content:"";
    position:absolute;
    inset: 6px;
    border-radius: 14px;
    border: 2px solid rgba(255,90,20,.55);
    pointer-events:none;
  }
  .vrow.hide-top-border{ border-top-color: transparent; }

  .vleft, .vright{ min-width:0; }
  .vleft b{ display:block; font-weight: 950; word-break: break-word; }
  .vleft small{ display:block; margin-top: 2px; color: rgba(11,18,32,.62); font-weight: 800; }
  .vright{
    text-align:right;
    font-weight: 950;
    white-space: nowrap;
    padding-right: 26px;
  }

  .veh-img{
    width: 96px;
    height: 60px;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid rgba(0,0,0,.08);
    flex: 0 0 auto;
    background: #fff;
  }

  .flow-actions{
    margin-top: 18px;
    position: sticky;
    bottom: 0;
    z-index: 5;
    background: rgba(255,255,255,.96);
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(11,18,32,.10);
    padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
    display:flex;
    gap: 12px;
    justify-content: space-between;
    flex-wrap: wrap;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    will-change: transform;
  }

  .flow-actions .btn{
    border-radius: 14px;
    padding: 12px 14px;
    box-shadow:none;
  }
  .flow-actions .btn-primary{
    box-shadow: 0 16px 34px rgba(255,90,20,.18);
  }
  .btn:disabled{ opacity:.55; cursor:not-allowed; }

  html.overlay-open .whatsapp-float{ display:none !important; }

  label{
    display:block;
    margin: 12px 0 6px;
    font-size: 12.5px;
    font-weight: 900;
    color: rgba(11,18,32,.74);
    letter-spacing: .18px;
  }
  input, select, textarea{
    width:100%;
    padding: 12px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.14);
    background: #f4f5f7;
    color: rgba(11,18,32,.92);
    outline:none;
    font-weight: 800;
    font-size: 16px;
  }
  textarea{min-height: 92px; resize: vertical}

  .estimate-box{
    margin-top: 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fbfbfc;
    padding: 12px;
  }
  .estimate-top{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
  .estimate-top b{font-size:13.5px}
  .estimate-value{font-weight:950}
  .estimate-sub{margin-top:6px;color: rgba(11,18,32,.68);font-size:12.8px;font-weight:700}
  .tinyhint{margin-top:6px;font-size:12.5px;color:rgba(11,18,32,.62);font-weight:700}

  .section{ margin-top: 46px; }
  h2{ font-size: 30px; letter-spacing: -.2px; line-height:1.15; }
  .subtitle{
    margin-top: 10px;
    color: rgba(11,18,32,.66);
    font-weight: 700;
    max-width: 920px;
  }
  .grid3{
    margin-top: 16px;
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 14px;
  }
  .card{
    border-radius: var(--radius);
    border: 1px solid rgba(11,18,32,.10);
    background: #fff;
    box-shadow: 0 14px 36px rgba(0,0,0,.08);
    overflow:hidden;
  }
  .card-media img{width:100%;aspect-ratio: 16/10;object-fit:cover;display:block}
  .card-body{padding: 14px}
  .card-body h3{ font-size: 17px; letter-spacing: -.1px; }
  .meta{ margin-top: 6px; color: rgba(11,18,32,.66); font-weight:700; font-size: 13.5px; }
  .price{ margin-top: 10px; font-weight: 950; }
  .min{ margin-top: 3px; color: rgba(11,18,32,.58); font-weight: 800; font-size: 12.5px; }
  .actions{ margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; }
  .actions .btn{ box-shadow:none; }
  .actions-reserve .btn{ font-size: 13.5px; padding: 10px 14px; }
  .btn-whatsapp{
    border: none;
    color: #fff;
    background: linear-gradient(90deg, #22c55e, #16a34a);
    box-shadow: 0 16px 34px rgba(34,197,94,.22);
  }

  .selected-vehicle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(11,18,32,.12);
    background: #f5f6f8;
    font-size: 13px;
    font-weight: 800;
    color: rgba(11,18,32,.8);
  }
  .selected-vehicle-info{
    display:flex;
    align-items:center;
    gap:10px;
    min-width: 0;
  }
  .selected-vehicle-info img{
    width: 44px;
    height: 32px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid rgba(11,18,32,.12);
    background: #fff;
    flex: 0 0 auto;
  }
  .selected-vehicle button{
    border: 1px solid rgba(11,18,32,.16);
    background: #fff;
    border-radius: 999px;
    padding: 6px 12px;
    font-weight: 800;
    cursor:pointer;
  }

  footer{
    margin-top: 64px;
    padding: 26px 0;
    text-align:center;
    color: rgba(11,18,32,.62);
    border-top: 1px solid rgba(11,18,32,.10);
    font-weight: 700;
  }

  .whatsapp-float{
    position:fixed;
    right: 96px;
    bottom: 16px;
    background:#25D366;
    color:#0b0b0b;
    padding: 12px 16px;
    border-radius: 999px;
    font-weight: 950;
    box-shadow: 0 16px 38px rgba(0,0,0,.16);
    z-index:60;
    border: 1px solid rgba(0,0,0,.14);
  }

  @media (max-width: 680px){
    .overlay-top .container{ padding-left: 12px; padding-right: 12px; }
    .overlay-title{ font-size: 14px; }
    .overlay-close{ padding: 9px 10px; border-radius: 12px; }

    .vrow{
      display: grid;
      grid-template-columns: 76px 1fr auto;
      align-items: center;
      gap: 12px;
    }
    .veh-img{
      width: 76px;
      height: 52px;
      border-radius: 12px;
    }
    .vright{
      padding-right: 18px;
      text-align: right;
    }
    .vleft b{ font-size: 15px; line-height: 1.2; }
    .vleft small{ font-size: 12.5px; }

    .flow-actions{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      margin-top: 0;
      padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
      z-index: 999999;
    }

    .flow-actions .btn{
      flex: 1 1 auto;
      min-width: 140px;
    }
  }

  @media (max-width: 980px){
    .hero-inner{ grid-template-columns: 1fr; }
    .booking-card{ justify-self:stretch; margin: 14px 18px 0; width:auto; }
    .grid3{ grid-template-columns: 1fr; }
    .row2{ grid-template-columns: 1fr; }
  }
  @media (max-width: 860px){
    .links{ display:none; }
    .pill{ display:inline-flex; }
    .header-actions .btn{ display:none; }
  }
</style>
</head>

<body>
<header>
  <div class="container">
    <div class="nav">
      <div class="brand">
        <div class="logo">MT</div>
        <div>Mont Tremblant Limo</div>
      </div>

      <div class="links">
        <a href="#fleet">Our fleet</a>
        <a href="#routes">Destinations</a>
        <a href="#faq">FAQ</a>
      </div>

      <div class="header-actions">
        <span class="pill">ðŸ“ž <a href="tel:+15142933170">+1 (514) 293-3170</a></span>
        <a class="btn" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
      </div>
    </div>
  </div>
</header>

<div class="hero-wrap">
  <div class="hero-inner container">
    <div class="hero-left">
      <div class="hero-title">Luxury chauffeur service in Mont-Tremblant</div>
      <div class="hero-sub">Airport transfers, hourly bookings, ski trips, corporate travel and special events.</div>

      <div class="hero-badges">
        <span class="badge">24/7 booking</span>
        <span class="badge">Professional chauffeurs</span>
        <span class="badge">Premium vehicles</span>
        <span class="badge">Mont-Tremblant â€¢ MontrÃ©al â€¢ Ottawa</span>
      </div>
    </div>

    <aside id="booking" class="booking-card" aria-label="Search booking">
      <div class="tabs">
        <button id="tabOneWay" class="tab active" type="button" aria-selected="true">One way</button>
        <button id="tabHourly" class="tab" type="button" aria-selected="false">By the hour</button>
      </div>

      <div class="book-body">
        <div class="stepbar" aria-hidden="true">
          <div class="stepdot"><i></i></div>
          <div class="steptext">Step 1 of 3</div>
        </div>

        <form id="heroSearchForm">
          <input type="hidden" id="heroMode" value="one_way" />

          <!-- âœ… store coordinates when user picks a suggestion -->
          <input type="hidden" id="h_pickup_lat" value="" />
          <input type="hidden" id="h_pickup_lng" value="" />
          <input type="hidden" id="h_dropoff_lat" value="" />
          <input type="hidden" id="h_dropoff_lng" value="" />

          <div id="selectedVehicleBanner" class="selected-vehicle" style="display:none;">
            <div class="selected-vehicle-info">
              <img id="selectedVehicleImage" src="" alt="" />
              <span>Selected vehicle: <b id="selectedVehicleName"></b></span>
            </div>
            <button id="clearSelectedVehicle" type="button">Clear</button>
          </div>

          <!-- Pickup -->
          <div class="autocomplete-wrap">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s7-6 7-11a7 7 0 1 0-14 0c0 5 7 11 7 11Z" stroke="currentColor" stroke-width="2"/>
                <path d="M12 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_pickup" placeholder="From: address, airport, hotelâ€¦" autocomplete="off" required />
            </div>
            <div id="h_pickup_list" class="autocomplete-list" role="listbox" aria-label="Pickup suggestions"></div>
          </div>

          <!-- Dropoff -->
          <div id="heroDropoffWrap" class="autocomplete-wrap">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s7-6 7-11a7 7 0 1 0-14 0c0 5 7 11 7 11Z" stroke="currentColor" stroke-width="2"/>
                <path d="M12 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_dropoff" placeholder="To: address, airport, hotelâ€¦" autocomplete="off" required />
            </div>
            <div id="h_dropoff_list" class="autocomplete-list" role="listbox" aria-label="Dropoff suggestions"></div>
          </div>

          <div class="row2">
            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 2v3M17 2v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M3 9h18" stroke="currentColor" stroke-width="2"/>
                <path d="M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <input id="h_date" type="date" required />
            </div>

            <div class="field">
              <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 8v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="2"/>
              </svg>
              <select id="h_time" required></select>
            </div>
          </div>

          <div id="heroTransferWrap" class="field" style="margin-top:10px">
            <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M3 11h18M6 11V7a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M7 20a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM17 20a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <select id="h_transfer">
              <option value="point" selected>City / Point-to-point</option>
              <option value="airport">Airport transfer</option>
            </select>
          </div>

          <div id="heroHoursWrap" class="field" style="display:none; margin-top:10px">
            <svg class="ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 8v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            <select id="h_hours">
              <option value="3">3 hours</option>
              <option value="4">4 hours</option>
              <option value="5">5 hours</option>
              <option value="6">6 hours</option>
              <option value="8">8 hours</option>
            </select>
          </div>

          <div class="note">Professional chauffeur â€¢ clean premium vehicles.</div>

          <button id="heroSearchBtn" class="search-btn" type="submit">Search</button>
          <div id="heroAlert" class="alert bad"></div>
        </form>
      </div>
    </aside>
  </div>
</div>

<!-- STEP 2: Vehicle selection -->
<div id="overlayVehicles" class="overlay" aria-hidden="true">
  <div class="overlay-top">
    <div class="container">
      <div class="overlay-title">Mont Tremblant Limo â€¢ Booking</div>
      <button class="overlay-close" type="button" onclick="closeOverlay('overlayVehicles', true)">Close</button>
    </div>
  </div>
  <div class="overlay-body">
    <div class="flow-wrap">
      <div class="flow-steps">
        <span>Search</span> <span>â€º</span>
        <span class="on">Service Class</span> <span>â€º</span>
        <span>Checkout</span>
      </div>

      <div class="summary-pill" id="tripSummary"></div>

      <div class="flow-h1">Select a vehicle</div>
      <div class="flow-sub">Prices shown are estimates.</div>

      <div class="vlist" id="vehicleOverlayList"></div>

      <div class="flow-actions">
        <button class="btn" type="button" onclick="backToSearch()">Edit search</button>
        <button id="btnVehicleContinue" class="btn btn-primary" type="button" disabled onclick="goToCheckoutOverlay()">Continue</button>
      </div>
    </div>
  </div>
</div>

<!-- STEP 3: Checkout -->
<div id="overlayCheckout" class="overlay" aria-hidden="true">
  <div class="overlay-top">
    <div class="container">
      <div class="overlay-title">Mont Tremblant Limo â€¢ Checkout</div>
      <button class="overlay-close" type="button" onclick="closeOverlay('overlayCheckout', true)">Close</button>
    </div>
  </div>
  <div class="overlay-body">
    <div class="flow-wrap">
      <div class="flow-steps">
        <span>Search</span> <span>â€º</span>
        <span>Service Class</span> <span>â€º</span>
        <span class="on">Checkout</span>
      </div>

      <div class="summary-pill" id="checkoutSummary"></div>

      <div class="flow-h1">Your details</div>
      <div class="flow-sub">Enter your name and phone, then pay securely via Stripe.</div>

      <label for="c_name">Name</label>
      <input id="c_name" placeholder="Your name" />

      <label for="c_phone">Phone</label>
      <input id="c_phone" placeholder="+1 ..." />

      <label for="c_notes">Notes (optional)</label>
      <textarea id="c_notes" placeholder="Passengers, luggage, flight #, stopsâ€¦"></textarea>

      <div class="estimate-box" style="margin-top:14px;">
        <div class="estimate-top">
          <b>Total estimate</b>
          <div class="estimate-value" id="checkoutTotal">â€”</div>
        </div>
        <div class="estimate-sub" id="checkoutSub"></div>
      </div>

      <div class="flow-actions" style="margin-top:14px;">
        <button class="btn" type="button" onclick="backToVehicles()">Back</button>
        <button class="btn btn-primary" type="button" onclick="startStripeCheckoutFromOverlay()">Pay with Stripe</button>
        <button class="btn" type="button" onclick="sendWhatsAppFromOverlay()">WhatsApp</button>
      </div>

      <div class="tinyhint" id="checkoutStatus" style="margin-top:10px;"></div>
    </div>
  </div>
</div>

<main class="container">
  <section id="fleet" class="section">
    <h2>Our Fleet</h2>
    <p class="subtitle">Premium vehicles for Mont-Tremblant travel. <b>Minimum 3 hours</b> applies to all vehicles.</p>

    <div class="grid3">
      <div class="card">
        <div class="card-media"><img src="escalade.jpg" alt="2026 Cadillac Escalade ESV black"></div>
        <div class="card-body">
          <h3>2026 Cadillac Escalade ESV</h3>
          <div class="meta">Ultra-luxury â€¢ VIP airport transfers â€¢ ski trips</div>
          <div class="price">$150 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="escalade" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="escalade" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="suburban.jpg" alt="2025 Chevrolet Suburban black"></div>
        <div class="card-body">
          <h3>2025 Chevrolet Suburban</h3>
          <div class="meta">Spacious â€¢ luggage friendly â€¢ long rides</div>
          <div class="price">$120 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="suburban" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="suburban" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="denali.jpg" alt="2026 GMC Yukon Denali black"></div>
        <div class="card-body">
          <h3>2026 GMC Yukon Denali</h3>
          <div class="meta">Premium comfort â€¢ smooth ride â€¢ executive travel</div>
          <div class="price">$120 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="denali" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="denali" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="qx60.jpg" alt="2024 Infiniti QX60 black"></div>
        <div class="card-body">
          <h3>2024 Infiniti QX60</h3>
          <div class="meta">Comfort + value â€¢ airport transfers â€¢ city rides</div>
          <div class="price">$99 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="qx60" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="qx60" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="tesla.jpg" alt="2023 Tesla Model Y black"></div>
        <div class="card-body">
          <h3>2023 Tesla Model Y</h3>
          <div class="meta">Quiet â€¢ modern â€¢ eco-friendly</div>
          <div class="price">$75 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="tesla" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="tesla" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-media"><img src="sprinter.jpg" alt="Black Mercedes Sprinter van"></div>
        <div class="card-body">
          <h3>Mercedes Sprinter (Group Van)</h3>
          <div class="meta">Groups â€¢ events â€¢ ski luggage</div>
          <div class="price">$250 / hour</div>
          <div class="min">3-hour minimum</div>
          <div class="actions actions-reserve">
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="sprinter" data-mode="one_way">Reserve Point A to Point B</a>
            <a class="btn btn-primary reserve-btn" href="#booking" data-vehicle="sprinter" data-mode="hourly">Reserve by hour</a>
            <a class="btn btn-whatsapp" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    Â© <span id="year"></span> Mont Tremblant Limo Services â€¢ All rights reserved
  </footer>
</main>

<a class="whatsapp-float" href="https://wa.me/15142933170" target="_blank" rel="noreferrer">WhatsApp</a>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const BUSINESS_WA = "15142933170";

  const LOCAL_RATES = [
    { id:"escalade", name:"2026 Cadillac Escalade ESV", hourly:150, meta:"Ultra-luxury â€¢ VIP airport transfers â€¢ ski trips", img:"escalade.jpg" },
    { id:"suburban", name:"2025 Chevrolet Suburban", hourly:120, meta:"Spacious â€¢ luggage friendly â€¢ long rides", img:"suburban.jpg" },
    { id:"denali", name:"2026 GMC Yukon Denali", hourly:120, meta:"Premium comfort â€¢ smooth ride â€¢ executive travel", img:"denali.jpg" },
    { id:"qx60", name:"2024 Infiniti QX60", hourly:99, meta:"Comfort + value â€¢ airport transfers â€¢ city rides", img:"qx60.jpg" },
    { id:"tesla", name:"2023 Tesla Model Y", hourly:75, meta:"Quiet â€¢ modern â€¢ eco-friendly", img:"tesla.jpg" },
    { id:"sprinter", name:"Mercedes Sprinter (Group Van)", hourly:250, meta:"Groups â€¢ events â€¢ ski luggage", img:"sprinter.jpg" }
  ];

  const state = {
    mode: "one_way",
    pickup: "",
    dropoff: "",
    date: "",
    time: "",
    transfer: "point",
    hours: 3,
    preferredVehicleId: null,
    selectedVehicleId: null,
    computedVehicles: [],
    pickup_lat: "",
    pickup_lng: "",
    dropoff_lat: "",
    dropoff_lng: ""
  ,    route_seconds: null,
    route_distance_km: null,
    route_billable_hours: null
  };

  function $(id){ return document.getElementById(id); }
  function val(id){ return ($(id)?.value || "").trim(); }

  function formatMoney(n){
    if (!Number.isFinite(Number(n))) return "â€”";
    return "CA$" + Math.round(Number(n));
  }

  function buildTimeOptions(stepMinutes = 5, selectId){
    const timeEl = document.getElementById(selectId);
    if (!timeEl || timeEl.tagName !== "SELECT") return;

    timeEl.innerHTML = "";
    const ph = document.createElement("option");
    ph.value = "";
    ph.textContent = "Select time";
    ph.selected = true;
    ph.disabled = true;
    timeEl.appendChild(ph);

    const pad = (n)=> String(n).padStart(2,"0");
    for (let minutes = 0; minutes < 24 * 60; minutes += stepMinutes){
      const hh = Math.floor(minutes / 60);
      const mm = minutes % 60;
      const value = `${pad(hh)}:${pad(mm)}`;
      const hour12 = ((hh + 11) % 12) + 1;
      const ampm = hh < 12 ? "AM" : "PM";
      const label = `${hour12}:${pad(mm)} ${ampm}`;
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = label;
      timeEl.appendChild(opt);
    }
    const now = new Date();
    let mins = now.getHours() * 60 + now.getMinutes();
    mins = Math.ceil(mins / stepMinutes) * stepMinutes;
    if (mins >= 24*60) mins = 0;
    const hh = Math.floor(mins / 60);
    const mm = mins % 60;
    timeEl.value = `${pad(hh)}:${pad(mm)}`;
  }

  function clearAutocompleteList(listEl){
    if (!listEl) return;
    listEl.innerHTML = "";
    listEl.style.display = "none";
  }

  function renderAutocompleteList(listEl, items, onPick){
    if (!listEl) return;
    listEl.innerHTML = "";
    if (!items.length){
      listEl.style.display = "none";
      return;
    }

    items.forEach((item)=>{
      const btn = document.createElement("button");
      btn.type = "button";
      btn.innerHTML = `${item.main}<span class="muted">${item.sub}</span>`;
      btn.addEventListener("mousedown", (e)=>{
        e.preventDefault();
        onPick(item);
        clearAutocompleteList(listEl);
      });
      listEl.appendChild(btn);
    });

    listEl.style.display = "block";
  }

  // âœ… Airport code + airport name lookup (works without Google keys)
  const AIRPORTS = [
    { code:"YUL", name:"MontrÃ©alâ€“Trudeau International Airport", city:"MontrÃ©al (Dorval), QC", country:"Canada", lat:45.4706, lng:-73.7408 },
    { code:"YMX", name:"MontrÃ©alâ€“Mirabel International Airport", city:"Mirabel, QC", country:"Canada", lat:45.6795, lng:-74.0387 },
    { code:"YHU", name:"MontrÃ©al Saint-Hubert Longueuil Airport", city:"Longueuil, QC", country:"Canada", lat:45.5175, lng:-73.4169 },
    { code:"YYZ", name:"Toronto Pearson International Airport", city:"Toronto, ON", country:"Canada", lat:43.6777, lng:-79.6248 },
    { code:"YOW", name:"Ottawa International Airport", city:"Ottawa, ON", country:"Canada", lat:45.3225, lng:-75.6692 },
    { code:"YQB", name:"QuÃ©bec City Jean Lesage International Airport", city:"QuÃ©bec City, QC", country:"Canada", lat:46.7911, lng:-71.3933 },
    { code:"JFK", name:"John F. Kennedy International Airport", city:"New York, NY", country:"USA", lat:40.6413, lng:-73.7781 },
    { code:"EWR", name:"Newark Liberty International Airport", city:"Newark, NJ", country:"USA", lat:40.6895, lng:-74.1745 },
    { code:"LGA", name:"LaGuardia Airport", city:"New York, NY", country:"USA", lat:40.7769, lng:-73.8740 },
    { code:"BOS", name:"Boston Logan International Airport", city:"Boston, MA", country:"USA", lat:42.3656, lng:-71.0096 }
  ];

  function normalize(s){ return String(s || "").trim().toUpperCase(); }

  function findAirportSuggestions(query){
    const q = normalize(query);
    if (!q) return [];

    // If user types exactly 3 letters, treat as IATA first
    const looksLikeIATA = /^[A-Z]{3}$/.test(q);
    const tokens = q.split(/\s+/).filter(Boolean);

    const matches = AIRPORTS.filter(a=>{
      if (looksLikeIATA) return a.code === q;
      // allow searching by code anywhere ("YUL airport"), or by name/city
      const hay = `${a.code} ${a.name} ${a.city} ${a.country}`.toUpperCase();
      return tokens.every(t => hay.includes(t));
    }).slice(0, 6);

    return matches.map(a=>({
      type: "airport",
      main: `${a.name} (${a.code})`,
      sub: `${a.code} â€¢ ${a.city} â€¢ ${a.country}`,
      value: `${a.name} (${a.code}), ${a.city}`,
      lat: a.lat,
      lng: a.lng
    }));
  }

  // âœ… Better "street address" rendering using Photon properties
  function formatPhotonFeature(f){
    const p = f.properties || {};
    const g = f.geometry || {};
    const coords = Array.isArray(g.coordinates) ? g.coordinates : null;
    const lng = coords ? coords[0] : null;
    const lat = coords ? coords[1] : null;

    const housenumber = p.housenumber || "";
    const street = p.street || "";
    const name = p.name || "";

    const line1 = (housenumber || street)
      ? [housenumber, street].filter(Boolean).join(" ")
      : (name || p.locality || p.city || p.country || "Address");

    const city = p.city || p.locality || "";
    const region = p.state || p.region || "";
    const postcode = p.postcode || "";
    const country = p.country || "";
    const subParts = [city, region, postcode, country].filter(Boolean);
    const sub = subParts.join(", ") || "Select this address";

    const valueParts = [line1, city, region, postcode, country].filter(Boolean);
    const value = valueParts.join(", ");

    return {
      type: "address",
      main: line1,
      sub,
      value,
      lat: (typeof lat === "number" ? lat : null),
      lng: (typeof lng === "number" ? lng : null)
    };
  }

  async function fetchAddressSuggestions(query){
  const q = (query || "").trim();
  if (q.length < 2) return [];

  // Region bias: Montreal / Mont-Tremblant / Ottawa corridor (no API key).
  const BIAS_CENTER = { lat: 45.5017, lng: -73.5673 }; // MontrÃ©al
  // Loose bounding box: Ottawa (-76) to QuÃ©bec City (-71) and south to north.
  const VIEWBOX = { left: -76.2, top: 46.9, right: -70.8, bottom: 44.8 };

  const photonUrl = `https://photon.komoot.io/api/?q=${encodeURIComponent(q)}&limit=10&lang=en&lat=${BIAS_CENTER.lat}&lon=${BIAS_CENTER.lng}`;
  const nominatimUrlBounded =
    `https://nominatim.openstreetmap.org/search?` +
    `q=${encodeURIComponent(q)}` +
    `&format=jsonv2&addressdetails=1&namedetails=1&limit=10` +
    `&accept-language=en&countrycodes=ca` +
    `&viewbox=${VIEWBOX.left},${VIEWBOX.top},${VIEWBOX.right},${VIEWBOX.bottom}&bounded=1`;

  const nominatimUrlCanada =
    `https://nominatim.openstreetmap.org/search?` +
    `q=${encodeURIComponent(q)}` +
    `&format=jsonv2&addressdetails=1&namedetails=1&limit=10` +
    `&accept-language=en&countrycodes=ca`;

  const haversineKm = (aLat, aLng, bLat, bLng) => {
    const R = 6371;
    const toRad = (x)=> (x * Math.PI / 180);
    const dLat = toRad(bLat - aLat);
    const dLng = toRad(bLng - aLng);
    const s1 = Math.sin(dLat/2), s2 = Math.sin(dLng/2);
    const aa = s1*s1 + Math.cos(toRad(aLat))*Math.cos(toRad(bLat))*s2*s2;
    return 2 * R * Math.asin(Math.min(1, Math.sqrt(aa)));
  };

  const scoreByDistance = (item) => {
    if (!item || !Number.isFinite(item.lat) || !Number.isFinite(item.lng)) return 999999;
    return haversineKm(BIAS_CENTER.lat, BIAS_CENTER.lng, item.lat, item.lng);
  };

  const [photonItems, nominatimItems] = await Promise.allSettled([
([
    (async ()=>{
      if (q.length < 3) return [];
      const res = await fetch(photonUrl, { headers: { "Accept":"application/json" } });
      if (!res.ok) return [];
      const data = await res.json().catch(()=> ({}));
      const feats = Array.isArray(data.features) ? data.features : [];
      return feats.map(formatPhotonFeature);
    })(),
    (async ()=>{
      const fetchNomi = async (url)=>{
        const res = await fetch(url, { headers: { "Accept":"application/json" } });
        if (!res.ok) return [];
        const data = await res.json().catch(()=> ([]));
        const arr = Array.isArray(data) ? data : [];
        return arr.map(formatNominatimItem);
      };

      // Try bounded corridor first (better for local POIs like hotels), then fall back to Canada-wide.
      let items = await fetchNomi(nominatimUrlBounded);
      if (!items.length && q.length >= 3) items = await fetchNomi(nominatimUrlCanada);
      return items;
    })()
  ]);

  const a = (photonItems.status === "fulfilled") ? photonItems.value : [];
  const b = (nominatimItems.status === "fulfilled") ? nominatimItems.value : [];
  const merged = [...b, ...a]; // Nominatim first (POIs), then Photon (addresses)

  // de-dupe by (value + lat/lng)
  const seen = new Set();
  const out = [];
  for (const it of merged){
    const k = `${(it.value||"").toLowerCase()}|${it.lat||""}|${it.lng||""}`;
    if (!it.value || seen.has(k)) continue;
    seen.add(k);
    out.push(it);
  }

  // Bias results to the local service area first.
  out.sort((x, y) => scoreByDistance(x) - scoreByDistance(y));

  // If everything is extremely far (e.g., user typed something unrelated), still show a few.
  return out.slice(0, 6);
}

function formatNominatimItem(item){
  const lat = Number(item?.lat);
  const lng = Number(item?.lon);
  const addr = item?.address || {};
  const namedetails = item?.namedetails || {};
  const name = namedetails?.name || item?.name || "";

  const city = addr.city || addr.town || addr.village || addr.hamlet || "";
  const region = addr.state || addr.region || "";
  const postcode = addr.postcode || "";
  const country = addr.country || "";
  const road = addr.road || addr.pedestrian || addr.footway || "";
  const house = addr.house_number || "";

  const line1 = name || ([house, road].filter(Boolean).join(" ") || (item?.display_name ? String(item.display_name).split(",")[0] : "Address"));
  const sub = [city, region, postcode, country].filter(Boolean).join(", ") || "Select this place";
  const value = item?.display_name ? String(item.display_name) : [line1, city, region, postcode, country].filter(Boolean).join(", ");

  return {
    type: "poi",
    main: line1,
    sub,
    value,
    lat: Number.isFinite(lat) ? lat : null,
    lng: Number.isFinite(lng) ? lng : null
  };
}

async function geocodeFirst(query){
  const q = (query || "").trim();
  if (!q) return null;

  // One-shot geocode used on form submit if the user didn't click a suggestion.
  // Try a local corridor first, then fall back to Canada-wide.
  const viewbox = { left: -76.2, top: 46.9, right: -70.8, bottom: 44.8 };

  const urlBounded =
    `https://nominatim.openstreetmap.org/search?` +
    `q=${encodeURIComponent(q)}` +
    `&format=jsonv2&addressdetails=1&namedetails=1&limit=1` +
    `&accept-language=en&countrycodes=ca` +
    `&viewbox=${viewbox.left},${viewbox.top},${viewbox.right},${viewbox.bottom}&bounded=1`;

  const urlCanada =
    `https://nominatim.openstreetmap.org/search?` +
    `q=${encodeURIComponent(q)}` +
    `&format=jsonv2&addressdetails=1&namedetails=1&limit=1` +
    `&accept-language=en&countrycodes=ca`;

  try{
    const fetchOne = async (url)=>{
      const res = await fetch(url, { headers: { "Accept":"application/json" } });
      if (!res.ok) return null;
      const data = await res.json().catch(()=> ([]));
      const item = Array.isArray(data) ? data[0] : null;
      return item ? formatNominatimItem(item) : null;
    };

    let hit = await fetchOne(urlBounded);
    if (!hit) hit = await fetchOne(urlCanada);
    return hit;
  }catch(_e){
    return null;
  }
}

async function fetchRouteOSRM(pickLat, pickLng, dropLat, dropLng){
  const lat1 = Number(pickLat), lng1 = Number(pickLng);
  const lat2 = Number(dropLat), lng2 = Number(dropLng);
  if (![lat1,lng1,lat2,lng2].every(Number.isFinite)) return null;

  const url = `https://router.project-osrm.org/route/v1/driving/${lng1},${lat1};${lng2},${lat2}?overview=false&alternatives=false&steps=false`;
  try{
    const res = await fetch(url, { headers: { "Accept":"application/json" } });
    if (!res.ok) return null;
    const data = await res.json().catch(()=> ({}));
    const route = Array.isArray(data?.routes) ? data.routes[0] : null;
    if (!route) return null;
    const seconds = Number(route.duration);
    const distanceKm = Number(route.distance) / 1000;
    if (!Number.isFinite(seconds) || !Number.isFinite(distanceKm)) return null;
    return { seconds, distanceKm };
  }catch(_e){
    return null;
  }
}

function roundUpTo(n, step){
  const x = Number(n);
  const s = Number(step);
  if (!Number.isFinite(x) || !Number.isFinite(s) || s <= 0) return x;
  return Math.ceil(x / s) * s;
}

function formatDuration(seconds){
  const s = Math.max(0, Math.round(Number(seconds) || 0));
  const h = Math.floor(s / 3600);
  const m = Math.round((s % 3600) / 60);
  if (h <= 0) return `${m} min`;
  if (m <= 0) return `${h} hr`;
  return `${h} hr ${m} min`;
}


  function setCoords(latId, lngId, lat, lng){
    const latEl = $(latId);
    const lngEl = $(lngId);
    if (latEl) latEl.value = (lat ?? "");
    if (lngEl) lngEl.value = (lng ?? "");
  }

  function clearCoords(latId, lngId){
    setCoords(latId, lngId, "", "");
  }

  function setupAutocomplete(inputId, listId, latId, lngId){
    const input = $(inputId);
    const list = $(listId);
    if (!input || !list) return;

    let timer = null;
    let token = 0;

    const onPick = (item)=>{
      input.value = item.value;
      setCoords(latId, lngId, item.lat, item.lng);
    };

    const doSearch = async ()=>{
      const q = input.value.trim();
      if (q.length < 2){
        clearAutocompleteList(list);
        return;
      }

      const current = ++token;

      // Airports first (so typing YUL instantly works)
      const airportItems = findAirportSuggestions(q);

      // Addresses second (street addresses / hotels / POIs)
      const addressItems = (q.length >= 3) ? await fetchAddressSuggestions(q) : [];

      if (current !== token) return;

      // de-dupe by value
      const seen = new Set();
      const merged = [];
      [...airportItems, ...addressItems].forEach(it=>{
        const k = (it.value || "").toLowerCase();
        if (!k || seen.has(k)) return;
        seen.add(k);
        merged.push(it);
      });

      renderAutocompleteList(list, merged.slice(0, 8), onPick);
    };

    input.addEventListener("input", ()=>{
      // if user edits manually after choosing a suggestion, clear coordinates
      clearCoords(latId, lngId);

      if (timer) clearTimeout(timer);
      timer = setTimeout(doSearch, 120);
    });

    input.addEventListener("blur", ()=> setTimeout(()=> clearAutocompleteList(list), 120));
    input.addEventListener("focus", ()=>{
      if (input.value.trim().length >= 2) doSearch();
    });

    // close list on Esc
    input.addEventListener("keydown", (e)=>{
      if (e.key === "Escape") clearAutocompleteList(list);
    });
  }

  function setHeroMode(mode){
    state.mode = mode;
    $("heroMode").value = mode;

    const one = mode === "one_way";
    $("tabOneWay").classList.toggle("active", one);
    $("tabHourly").classList.toggle("active", !one);

    $("heroDropoffWrap").style.display = one ? "" : "none";
    $("heroTransferWrap").style.display = one ? "" : "none";
    $("heroHoursWrap").style.display = one ? "none" : "";

    $("h_dropoff").required = one;
  }

  function setPreferredVehicle(vehicleId){
    state.preferredVehicleId = vehicleId || null;
    const vehicle = LOCAL_RATES.find(v=>v.id === state.preferredVehicleId);
    const banner = $("selectedVehicleBanner");
    const nameEl = $("selectedVehicleName");
    const imageEl = $("selectedVehicleImage");
    if (!banner || !nameEl) return;
    if (vehicle){
      nameEl.textContent = vehicle.name;
      if (imageEl){
        imageEl.src = vehicle.img;
        imageEl.alt = vehicle.name;
      }
      banner.style.display = "flex";
    }else{
      nameEl.textContent = "";
      if (imageEl){
        imageEl.src = "";
        imageEl.alt = "";
      }
      banner.style.display = "none";
    }
  }

  function showHeroAlert(message){
    const el = $("heroAlert");
    el.style.display = "block";
    el.textContent = message;
  }
  function clearHeroAlert(){
    const el = $("heroAlert");
    el.style.display = "none";
    el.textContent = "";
  }

  function validateHero(){
    if (!val("h_pickup")) return "Please enter a pickup location.";
    if (state.mode === "one_way" && !val("h_dropoff")) return "Please enter a destination.";
    if (!$("h_date").value) return "Please choose a date.";
    if (!val("h_time")) return "Please choose a time.";
    return null;
  }

  function calcVehicleTotal(vehicle){
  const h = Math.max(3, Number(state.hours || 3));
  if (state.mode === "hourly") return vehicle.hourly * h;

  // One-way live pricing:
  // bill based on estimated drive time (rounded up to 30 minutes), minimum 3 hours.
  const fee = state.transfer === "airport" ? 60 : 40;

  if (Number.isFinite(Number(state.route_seconds))){
    const driveHours = Number(state.route_seconds) / 3600;
    const billable = Math.max(3, roundUpTo(driveHours, 0.5));
    state.route_billable_hours = billable;
    return (vehicle.hourly * billable) + fee;
  }

  // Fallback if we can't compute a route (e.g., no coords)
  return (vehicle.hourly * 3) + fee;
}

  function buildVehiclesForTrip(){
  const ORDER = ["escalade","suburban","denali","qx60","tesla","sprinter"];
  const hours = Math.max(3, Number(state.hours || 3));

  const routePart = (state.mode !== "hourly" && Number.isFinite(Number(state.route_seconds)))
    ? `Drive ~${formatDuration(state.route_seconds)} â€¢ ${Math.round(Number(state.route_distance_km||0))} km`
    : null;

  const billedPart = (state.mode !== "hourly" && Number.isFinite(Number(state.route_billable_hours)))
    ? `Billed ${Number(state.route_billable_hours).toFixed(1).replace(/\.0$/,"")} hrs`
    : null;

  const list = LOCAL_RATES.map(v=>{
    const total = calcVehicleTotal(v);

    const note = (state.mode === "hourly")
      ? `Total ${formatMoney(total)} for ${hours} hours`
      : ([ (state.transfer === "airport" ? "Airport transfer" : "Point-to-point"), routePart, billedPart ].filter(Boolean).join(" â€¢ ") || "Estimate");

    return { ...v, total, note };
  });

  list.sort((a,b)=>ORDER.indexOf(a.id) - ORDER.indexOf(b.id));
  return list;
}

  let __scrollY = 0;
  function lockBodyScroll(){
    __scrollY = window.scrollY || 0;
    document.body.style.position = "fixed";
    document.body.style.top = `-${__scrollY}px`;
    document.body.style.left = "0";
    document.body.style.right = "";
    document.body.style.width = "100%";
  }
  function unlockBodyScroll(){
    document.body.style.position = "";
    document.body.style.top = "";
    document.body.style.left = "";
    document.body.style.right = "";
    document.body.style.width = "";
    window.scrollTo(0, __scrollY);
  }

  function anyOverlayOpen(){
    return !!document.querySelector(".overlay.show");
  }

  function closeAllOverlaysVisual(){
    document.querySelectorAll(".overlay.show").forEach(el=>{
      el.classList.remove("show");
      el.setAttribute("aria-hidden","true");
    });
    document.documentElement.classList.remove("overlay-open");
    unlockBodyScroll();
    try{
      if (window.Tawk_API && typeof window.Tawk_API.showWidget === "function") {
        window.Tawk_API.showWidget();
      }
    }catch(e){}
  }

  function syncFlowBarHeight(overlayId){
    const overlay = document.getElementById(overlayId);
    if (!overlay) return;
    const bar = overlay.querySelector(".flow-actions");
    if (!bar) return;
    const h = Math.ceil(bar.getBoundingClientRect().height);
    if (h > 0) document.documentElement.style.setProperty("--flowbar-h", h + "px");
  }

  function syncViewportHeight(){
    const vh = (window.visualViewport?.height || window.innerHeight || 0);
    if (vh) document.documentElement.style.setProperty("--vh", vh + "px");
  }

  function forceIOSPaint(overlayId){
    const overlay = document.getElementById(overlayId);
    if (!overlay) return;

    const body = overlay.querySelector(".overlay-body");
    const bar  = overlay.querySelector(".flow-actions");

    if (overlay) void overlay.offsetHeight;
    if (body) void body.offsetHeight;
    if (bar) void bar.offsetHeight;

    if (body){
      const y = body.scrollTop;
      body.scrollTop = y + 1;
      body.scrollTop = y;
    }

    if (bar){
      const prev = bar.style.display;
      bar.style.display = "none";
      void bar.offsetHeight;
      bar.style.display = prev || "";
      void bar.offsetHeight;

      bar.style.transform = "translateZ(0)";
      bar.style.webkitTransform = "translateZ(0)";
    }
  }

  function scheduleIOSPaint(overlayId){
    forceIOSPaint(overlayId);
    requestAnimationFrame(()=>forceIOSPaint(overlayId));
    setTimeout(()=>forceIOSPaint(overlayId), 50);
    setTimeout(()=>forceIOSPaint(overlayId), 150);
    setTimeout(()=>forceIOSPaint(overlayId), 350);
  }

  function openOverlay(id, pushHistory = true){
    lockBodyScroll();
    document.documentElement.classList.add("overlay-open");

    const el = $(id);
    el.classList.add("show");
    el.setAttribute("aria-hidden","false");

    try{
      if (window.Tawk_API && typeof window.Tawk_API.hideWidget === "function") {
        window.Tawk_API.hideWidget();
      }
    }catch(e){}

    if (pushHistory){
      history.pushState({ overlay: id }, "", "#" + id);
    }

    syncFlowBarHeight(id);
    scheduleIOSPaint(id);
  }

  function closeOverlay(id, popHistory = false){
    const el = $(id);
    el.classList.remove("show");
    el.setAttribute("aria-hidden","true");

    if (!anyOverlayOpen()){
      document.documentElement.classList.remove("overlay-open");
      unlockBodyScroll();
      try{
        if (window.Tawk_API && typeof window.Tawk_API.showWidget === "function") {
          window.Tawk_API.showWidget();
        }
      }catch(e){}
      if (location.hash === "#overlayVehicles" || location.hash === "#overlayCheckout"){
        history.replaceState({ page: "home" }, "", location.pathname + location.search);
      }
    }

    if (popHistory && history.state && history.state.overlay){
      history.back();
    }
  }

  window.addEventListener("popstate", (e)=>{
    closeAllOverlaysVisual();
    if (e.state && e.state.overlay){
      openOverlay(e.state.overlay, false);
    }
  });

  window.addEventListener("resize", ()=>{
    syncViewportHeight();
    if (document.getElementById("overlayVehicles")?.classList.contains("show")) syncFlowBarHeight("overlayVehicles");
    if (document.getElementById("overlayCheckout")?.classList.contains("show")) syncFlowBarHeight("overlayCheckout");
  });
  window.visualViewport?.addEventListener("resize", syncViewportHeight);
  window.visualViewport?.addEventListener("scroll", syncViewportHeight);

  function backToSearch(){ history.back(); }
  function backToVehicles(){ history.back(); }

  function renderTripSummary(){
    const when = `${state.date} at ${state.time}`;
    const route = state.mode === "hourly"
      ? `${state.pickup} â†’ Hourly (Mont-Tremblant area)`
      : `${state.pickup} â†’ ${state.dropoff}`;

    $("tripSummary").innerHTML = `
      <div><b>${when}</b></div>
      <small>${route}</small>
    `;
  }

  function clearRowBorderHelpers(){
    document.querySelectorAll(".vrow").forEach(r=> r.classList.remove("hide-top-border"));
  }
  function applyRowBorderHelpers(selectedRow){
    clearRowBorderHelpers();
    if (!selectedRow) return;
    selectedRow.classList.add("hide-top-border");
    const next = selectedRow.nextElementSibling;
    if (next && next.classList.contains("vrow")) next.classList.add("hide-top-border");
  }

  function renderVehiclesOverlay(){
    const wrap = $("vehicleOverlayList");
    wrap.innerHTML = "";
    state.selectedVehicleId = null;
    $("btnVehicleContinue").disabled = true;

    const hours = Math.max(3, Number(state.hours || 3));
    let preferredRow = null;

    state.computedVehicles.forEach(v=>{
      const row = document.createElement("div");
      row.className = "vrow";
      row.dataset.vehicleId = v.id;

      const underVehicle = (state.mode === "hourly") ? "" : `<small>${v.note}</small>`;
      const underPrice = (state.mode === "hourly")
        ? `<small style="display:block;margin-top:2px;color:rgba(11,18,32,.62);font-weight:800;">Total ${formatMoney(v.total)} for ${hours} hours</small>`
        : `<small style="display:block;margin-top:2px;color:rgba(11,18,32,.62);font-weight:800;">${v.note}</small>`;

      row.innerHTML = `
        <img class="veh-img" src="${v.img}" alt="${v.name}" />
        <div class="vleft">
          <b>${v.name}</b>
          ${underVehicle}
        </div>
        <div class="vright">
          <div>${formatMoney(v.total)}</div>
          ${underPrice}
        </div>
        <div class="vcheck" aria-hidden="true">âœ“</div>
      `;

      row.addEventListener("click", ()=>{
        document.querySelectorAll(".vrow").forEach(x=>x.classList.remove("selected"));
        row.classList.add("selected");
        state.selectedVehicleId = v.id;
        $("btnVehicleContinue").disabled = false;
        applyRowBorderHelpers(row);
        syncFlowBarHeight("overlayVehicles");
        scheduleIOSPaint("overlayVehicles");
      });

      wrap.appendChild(row);
      if (state.preferredVehicleId && state.preferredVehicleId === v.id) preferredRow = row;
    });

    if (preferredRow){
      preferredRow.click();
      preferredRow.scrollIntoView({ block: "center" });
    }

    syncFlowBarHeight("overlayVehicles");
    scheduleIOSPaint("overlayVehicles");
  }

  function getChosenVehicle(){
    return state.computedVehicles.find(v=>v.id === state.selectedVehicleId) || null;
  }

  function goToCheckoutOverlay(){
    if (!state.selectedVehicleId) return;

    closeOverlay("overlayVehicles", false);

    const chosen = getChosenVehicle();
    const when = `${state.date} at ${state.time}`;
    const route = state.mode === "hourly"
      ? `${state.pickup} â†’ Hourly (Mont-Tremblant area)`
      : `${state.pickup} â†’ ${state.dropoff}`;

    $("checkoutSummary").innerHTML = `
      <div><b>${when}</b></div>
      <small>${route} â€¢ ${chosen?.name || ""}</small>
    `;

    $("checkoutTotal").textContent = chosen ? formatMoney(chosen.total) : "â€”";
    $("checkoutSub").textContent = chosen
      ? (state.mode === "hourly"
          ? `Total ${formatMoney(chosen.total)} for ${Math.max(3, Number(state.hours||3))} hours`
          : chosen.note)
      : "";

    openOverlay("overlayCheckout", true);
    syncFlowBarHeight("overlayCheckout");
  }

  function buildWhatsAppMessage(payload){
    const lines = [];
    lines.push("Booking Request - Mont Tremblant Limo Services");
    lines.push(`Name: ${payload.name || ""}`);
    if (payload.phone) lines.push(`Phone: ${payload.phone}`);
    lines.push(`Date: ${payload.date}`);
    lines.push(`Time: ${payload.time}`);
    lines.push(`Pickup: ${payload.pickup}`);
    lines.push(`Drop-off: ${payload.dropoff}`);
    lines.push(`Trip type: ${payload.triptype}`);
    lines.push(`Vehicle: ${payload.vehicle}`);
    lines.push(`Estimate: ${payload.estimate_text}`);
    if (payload.notes) lines.push(`Notes: ${payload.notes}`);
    return encodeURIComponent(lines.join("\n"));
  }

  function sendWhatsAppFromOverlay(){
    const chosen = getChosenVehicle();
    if (!chosen) return;

    const name = val("c_name");
    const phone = val("c_phone");
    const notes = val("c_notes");
    const triptype = (state.mode === "hourly") ? "Hourly" : (state.transfer === "airport" ? "Airport transfer" : "Point-to-point");

    const estimateText = (state.mode === "hourly")
      ? `Total ${formatMoney(chosen.total)} for ${Math.max(3, Number(state.hours||3))} hours`
      : `${formatMoney(chosen.total)} (${chosen.note})`;

    const payload = {
      name, phone,
      date: state.date,
      time: state.time,
      pickup: state.pickup,
      dropoff: (state.mode === "hourly") ? "Mont-Tremblant (area)" : state.dropoff,
      triptype,
      vehicle: chosen.name,
      estimate_text: estimateText,
      notes
    };

    window.open("https://wa.me/" + BUSINESS_WA + "?text=" + buildWhatsAppMessage(payload), "_blank", "noreferrer");
  }

  async function startStripeCheckoutFromOverlay(){
    const statusEl = $("checkoutStatus");
    statusEl.textContent = "";

    const chosen = getChosenVehicle();
    if (!chosen){
      statusEl.textContent = "Please choose a vehicle first.";
      return;
    }

    const name = val("c_name");
    if (!name){
      statusEl.textContent = "Please enter your name.";
      return;
    }

    const booking = {
      name: name,
      phone: val("c_phone"),
      date: state.date,
      time: state.time,
      pickup: state.pickup,
      dropoff: (state.mode === "hourly") ? "Mont-Tremblant (area)" : state.dropoff,
      triptype: (state.mode === "hourly") ? "hourly" : (state.transfer === "airport" ? "airport" : "point"),
      vehicle: chosen.name,
      vehicle_id: chosen.id,
      hours: String(Math.max(3, Number(state.hours||3))),
      roundtrip: "no",
      notes: val("c_notes"),
      estimate_text: (state.mode === "hourly")
        ? `Total ${formatMoney(chosen.total)} for ${Math.max(3, Number(state.hours||3))} hours`
        : `${formatMoney(chosen.total)} (${chosen.note})`,
      estimate_total_cad: chosen.total,
      pay_option: "full",
      pay_now_cad: chosen.total
    };

    try{
      statusEl.textContent = "Starting secure checkoutâ€¦";
      const res = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(booking)
      });
      const data = await res.json().catch(()=> ({}));
      if (!res.ok) throw new Error(data?.error || "Unable to start checkout.");
      if (!data?.url) throw new Error("Missing checkout URL from server.");
      window.location.href = data.url;
    }catch(err){
      console.error(err);
      statusEl.textContent = "Stripe checkout error: " + (err.message || "Unknown error");
      alert("Stripe checkout error: " + (err.message || "Unknown error"));
    }
  }

  function setHeroSearchLoading(isLoading){
    const btn = $("heroSearchBtn");
    btn.disabled = isLoading;
    btn.textContent = isLoading ? "Searchingâ€¦" : "Search";
  }

  $("tabOneWay").addEventListener("click", ()=> setHeroMode("one_way"));
  $("tabHourly").addEventListener("click", ()=> setHeroMode("hourly"));
  $("clearSelectedVehicle").addEventListener("click", ()=> setPreferredVehicle(null));

  document.querySelectorAll(".reserve-btn").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.preventDefault();
      const vehicleId = btn.dataset.vehicle;
      const mode = btn.dataset.mode || "one_way";
      const url = new URL(window.location.href);
      url.searchParams.set("vehicle", vehicleId);
      url.searchParams.set("mode", mode);
      url.hash = "booking";
      window.location.href = url.toString();
    });
  });

  $("heroSearchForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  clearHeroAlert();

  const err = validateHero();
  if (err) return showHeroAlert(err);

  state.pickup = val("h_pickup");
  state.dropoff = val("h_dropoff");
  state.date = $("h_date").value;
  state.time = val("h_time");
  state.transfer = val("h_transfer") || "point";
  state.hours = Math.max(3, Number(val("h_hours") || 3));

  // capture coords (if user picked from suggestions)
  state.pickup_lat = val("h_pickup_lat");
  state.pickup_lng = val("h_pickup_lng");
  state.dropoff_lat = val("h_dropoff_lat");
  state.dropoff_lng = val("h_dropoff_lng");

  // reset route cache each submit
  state.route_seconds = null;
  state.route_distance_km = null;
  state.route_billable_hours = null;

  setHeroSearchLoading(true);

  try{
    // If user typed a place name (e.g., "Four Seasons Hotel Montreal") but didn't click a suggestion,
    // do a one-shot geocode so we still get coordinates.
    if (!state.pickup_lat || !state.pickup_lng){
      const g = await geocodeFirst(state.pickup);
      if (g?.lat && g?.lng){
        state.pickup_lat = String(g.lat);
        state.pickup_lng = String(g.lng);
        setCoords("h_pickup_lat", "h_pickup_lng", g.lat, g.lng);
      }
    }

    if (state.mode === "one_way"){
      if (!state.dropoff_lat || !state.dropoff_lng){
        const g = await geocodeFirst(state.dropoff);
        if (g?.lat && g?.lng){
          state.dropoff_lat = String(g.lat);
          state.dropoff_lng = String(g.lng);
          setCoords("h_dropoff_lat", "h_dropoff_lng", g.lat, g.lng);
        }
      }

      // Live pricing needs route duration; compute it when we have both points.
      const route = await fetchRouteOSRM(state.pickup_lat, state.pickup_lng, state.dropoff_lat, state.dropoff_lng);
      if (route){
        state.route_seconds = route.seconds;
        state.route_distance_km = route.distanceKm;
      }
    }

    state.computedVehicles = buildVehiclesForTrip();
    renderTripSummary();
    renderVehiclesOverlay();

    openOverlay("overlayVehicles", true);
  }catch(ex){
    console.error(ex);
    showHeroAlert("Sorry â€” we couldn't calculate the trip right now. Please try again.");
  }finally{
    setHeroSearchLoading(false);
  }
});


  window.addEventListener("load", ()=>{
    if (!history.state){
      history.replaceState({ page: "home" }, "", location.pathname + location.search + (location.hash || ""));
    }

    syncViewportHeight();
    buildTimeOptions(5, "h_time");

    // âœ… Works for both one-way + hourly (pickup) and one-way dropoff
    setupAutocomplete("h_pickup", "h_pickup_list", "h_pickup_lat", "h_pickup_lng");
    setupAutocomplete("h_dropoff", "h_dropoff_list", "h_dropoff_lat", "h_dropoff_lng");

    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    $("h_date").value = `${yyyy}-${mm}-${dd}`;

    const params = new URLSearchParams(window.location.search);
    const preferredVehicle = params.get("vehicle");
    const preferredMode = params.get("mode");
    if (preferredVehicle){
      setHeroMode(preferredMode || "one_way");
      setPreferredVehicle(preferredVehicle);
      document.getElementById("booking")?.scrollIntoView({ behavior: "smooth", block: "start" });
      setTimeout(()=> $("h_pickup")?.focus(), 300);
    }else{
      setHeroMode("one_way");
      setPreferredVehicle(null);
    }
    document.getElementById("year").textContent = yyyy;

    if (location.hash === "#overlayVehicles") openOverlay("overlayVehicles", false);
    if (location.hash === "#overlayCheckout") openOverlay("overlayCheckout", false);
  });
</script>

<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6987db032260861c350b5c0a/default';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->

</body>
</html>
